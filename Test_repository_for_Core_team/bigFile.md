   ГЛОБАЛЬНЫЕ СКРИПТЫ
-------------------------------------

Помимо новых функций, sfall также добавляет глобальные скрипты. Они выполняются независимо от любых загруженных карт, но не имеют прикрепленного объекта (т.е. использование функции `self_obj` без использования специальной функции `set_self` приведет к сбою скрипта).

Чтобы использовать глобальный скрипт, у скрипта должно быть имя, начинающееся с `gl` и содержащий процедуру с именем `start`, `map_enter_p_proc`, `map_exit_p_proc` или `map_update_p_proc`.
Процедура `start` будет выполнена один раз, когда игрок загружает сохраненную игру или запускает новую игру.
Процедуры `map_*_p_proc` будут выполняться один раз при входе, выходе, и обновлении карты соответственно.

Порядок или приоритет выполнения глобальных скриптов зависит от имени файла глобального скрипта, и определяется прямым алфавитным порядком, так например скрипт с именем **gl_AAA.int** будет выполняться первым чем скрипт **gl_zzz.int**.

Если вы хотите, чтобы сценарий выполнялся циклически (повторно), вызовите функцию `set_global_script_repeat` при первом же запуске процедуры `start`, используя в качестве аргумента значение задержки повторных запусков, 0 - отключает выполнение (по умолчанию), 1 - запускает скрипт каждый кадр, 2 - запускает скрипт каждый второй кадр и т.д.

Глобальные скрипты имеют несколько режимов, которые можно задать с помощью функции `set_global_script_type`.
В режиме 0 (т.е. в режиме по умолчанию) их выполнение связано с циклом игры на локальной карте, поэтому скрипт не будет выполняться в интерфейсных окнах или на карте мира.
В режиме 1, их выполнение связано с вводом (input) игрока, поэтому скрипт будет выполняться всякий раз, когда курсор мыши виден на экране, включая карту мира, диалоги персонажей и т.д.
В режиме 2, выполнение связано с циклом карты мира, поэтому скрипт будет выполняться только на карте мира, но не на локальной карте или в каких-либо интерфейсных окнах.
Режим 3 представляет собой комбинацию режимов 0 и 2, поэтому скрипт будут выполняться как на локальных картах, так и на карте мира, но не в интерфейсных окнах.

Обе функции `set_global_script_repeat`, и `set_global_script_type` влияют только на скрипты, из которых они были вызваны. А каждый глобальный скрипт нуждается в собственном блоке `game_loaded`, чтобы правильно установить тип скрипта и частоту повторения процедуры `start`.
__Внимание__: `set_global_script_repeat` не будет иметь никакого эффекта, если её использовать вне глобального скрипта.

_Использование режима 1 требует, чтобы была включена оболочка функций ввода (input wrapper). Используйте `available_global_script_types`, чтобы проверить, что это доступно._ **-УСТАРЕЛО**.


-------------------------------------
   ЗАМЕЧАНИЯ ПО НОВЫМ ФУНКЦИЯМ
-------------------------------------

Функции `call_offset_xx` позволяют вызывать функций игры Fallout непосредственно из кода движка. Разные версии функций используются для вызова функций с разным количеством аргументов.
По умолчанию для sfall v5.1.0.0 все вызовы c помощью этих функций являются небезопасными, т.к. большенство функций игры были переписаны непосредственно в код sfall, и вызов старых функций движка Fallout является небезопасным, обратитесь к [разработчикам sfall](https://gitverse.ru/sfall_projects/sfall) с просьбой добавить требуемую функцию в список разрешенных.
__ВНИМАНИЕ__: При вызове не разрешенных функций игроки будут получать уведомление о вызове небезопасной функции.
Функции не будут работать для не разрешенных вызовов, если опция **AllowUnsafeScripting** не включена.

Функции `read_xxx` принимают в качестве параметра адрес памяти и могут читать произвольные фрагменты адресного пространства Fallout.

Функции `write_xxx` эквивалентны функциям чтения, за исключением того, что они записывают в произвольные адреса памяти (не рекомендуется к использованию). Функции не будут работать, если опция **AllowUnsafeScripting** не включена.

Функции `set_perk_***` могут использоваться для настройки параметров как ванильных так и дополнительных перков, дополнительные перки добавляются функцией `add_extra_perk`, или в файле перков опции **PerksFile**.

The `set_fake_trait` and `set_fake_perk` can be used to add additional traits and perks to the character screen. They will be saved correctly when the player saves and reloads games, but by themselves they will have no further effect on the character. For perks, the allowed range for levels is between 0 and 100; setting the level to 0 removes that perk. For traits, the level must be 0 or 1. The image is a numeric id that corresponds to an entry in **skilldex.lst**. The name is limited to 63 characters and the description to 255 characters by sfall, but internal Fallout limits may be lower.

The `has_fake_trait` and `has_fake_perk` return the number of levels the player has of the perks/traits with the given name or ID of extra perk.

The `perk_add_mode`, `set_selectable_perk`, `set_perkbox_title`, `hide_real_perks`, `show_real_perks` and `clear_selectable_perks` control the behaviour of the select a perk box. `set_selectable_perk` can be used to add additional items by setting the **active** parameter to 1, and to remove them again by setting it to 0. `set_perkbox_title` can be used to change the title of the box, or by using `""` it will be set back to the default. hide and `show_real_perks` can be used to prevent the dialog from displaying any of the original 119 perks. `perk_add_mode` modifies what happens when a fake perk is selected from the perks dialog. It is treated as a set of flags - if bit 1 is set then it is added to the player's traits, if bit 2 is set it is added to the player's perks, and if bit 3 is set it is removed from the list of selectable perks. The default is 0x2. `clear_selectable_perks` restores the dialog to its default state.

The `fs_*` functions are used to manipulate a virtual file system. Files saved here should have paths relative to the data folder, and use backslashes as the directory separator. They will take precedence over files stored in the normal data folder. They will also be saved into save games if you set a flag for them using `fs_resize(fileId, -1)`, so be avoid creating large files. Using `fs_copy` followed by `fs_read_xxx`, you can read the contents of existing files.

The `list_xxx` functions can be used to loop over all items on a map. `list_begin` takes an argument telling sfall what you want to list (defined in **sfall.h**). It returns a list pointer, which you iterate through with list_next. Finally, when you've finished with the list use `list_end` on it. Not calling `list_end` will result in a memory leak. Alternatively, use `list_as_array` to get the whole list at once as a temp array variable, which can be looped over using `len_array` and which you don't need to remember to free afterwards.

Arrays are created and manipulated with the `xxx_array` functions. An array must first be created with `create_array` or `temp_array`, specifying how many data elements the array can hold. You can store any of `int`, `float` and `string` in an array, and can mix all 3 in a single array. The ID returned by `create_array` or `temp_array` can then be used with the other array functions. Arrays are shared between all scripts. (i.e. you can call `create_array` from one script, and then use the returned id from another script.) They are also saved across savegames. You must remember to free any arrays you create with `create_array` when you are done with them, or you will leak memory. arrays created with `temp_array` will be automatically freed at the end of the frame. These functions are safe, in that supplying a bad id or trying to access out of range elements will not crash the script. `create_array` is the only function that returns a permanent array, all other functions which return arrays (`string_split`, `list_as_array` etc,) all return temp arrays. You can use `fix_array` to make a temp array permanent.  
__NOTE:__ the above description only applies when **ArraysBehavior** is set to 0 in ddraw.ini. Refer to **arrays.md** for detailed description of new arrays behavior.

Функция `apply_heaveho_fix` может использоваться для того, чтобы изменить применяемую формулу для перка "Размах", это снимет требование к силе и изменит расчет для максимальной дальности метания на +6 для каждого уровня перка при этом, дальность не будет ограничена максимальной дальностью оружия. Вы можете изменять модификатор дальности.


------------------------------
   УСТАРЕВШИЕ ФУНКЦИИ
------------------------------

The graphics functions are only available if the user is using graphics mode 4 or 5. Use `graphics_funcs_available` to check, it returns 1 if you can use them or 0 if you can't. Calling graphics functions when `graphics_funcs_available` returns 0 will do nothing.

The input functions are only available if the user has the input hook turned on in ddraw.ini. Use `input_funcs_available` to check.

The `nb_create_char` function are reserved for the brotherhood tactical training mod, and should be avoided.


------------------------------
   ИСПОЛЬЗОВАНИЕ ТИПОВ
------------------------------

Типы данных, упомянутые в этом документе:
- `void`      - означает, что функция не возвращает никакого значения
- `any`       - любой тип
- `int`       - целое число
- `float`     - число с плавающей запятой
- `string`    - строковое (текстовое) значение
- `object`    - указатель на игровой объект (фактически целое число)
- `array`     - идентификатор массива для использования в функциях, связанных с массивами (фактически целое число)
- `bool`      - булевы значения: `True` или `False` (фактически это целое число 1 или 0)
- `procedure` - имя процедуры скрипта

----------------------------------------------
   ОПИСАНИЕ ФУНКЦИЙ
----------------------------------------------

##### `int typeof(any value)`
- Возвращает тип указанного в аргументе значения: `VALTYPE_INT`, `VALTYPE_FLOAT` или `VALTYPE_STR`.

-----
##### `int game_loaded()`
- Возвращает 1 при первом вызове функции, например после начала новой игры или загрузки игры, и 0 после этого.
- Функция в основном предназначена для глобальных скриптов sfall, для инициализации (настройки) вашего глобального скрипта (например в вызове функции `set_global_script_repeat`).
- Функция работает индивидуально для каждого скрипта, также функцию можно вызывать и из обычных игровых скриптов (не рекомендуется этого делать).

-----
##### `int get_sfall_global(int/string gVariable)`
##### `int set_sfall_global(int/string gVariable)`
- Функции предназначены для работы с глобальные переменными sfall.
- Глобальные переменные sfall ведут себя так же, как и обычные глобальные переменные Fallout, за исключением того, что их не нужно заранее объявлять в **vault13.gam**.
- **gVariable**: Аргумент имени переменной может принимать как числовое значение номера переменной, так и строковое имя.
- __ВНИМАНИЕ__: В качестве имении переменной эти функции требуют строку длиной 8 символов с учетом регистра.
- При попытке получить переменную, которая не была установлена, функция `get_sfall_global` всегда будет возвращать 0. 
- Функции в основном предназначены для использования в тех случаях, когда для мода или патча требуется добавления новой глобальной переменной - в противном случае игроку пришлось бы начинать новую игру.

-----
##### `int show_iface_tag(int tag)`
##### `int hide_iface_tag(int tag)`
##### `int is_iface_tag_active(int tag)`
- Эти функции управляют окошками уведомлений, которые отображаются над игровой панелью игрока, такими как **SNEAK**, или **LEVEL**.
- Вы можете использовать значения аргумента **tag** от 0 до 4 (см. определения **_TAG** в **sfall.h**), и выше (до 4 + установленное значение опции **BoxBarCount** в ddraw.ini) если вы используете собственные окошки для уведомлений.
- Из ванильных уведомлений можно скрыть/отобразить только **SNEAK**, **LEVEL** и **ADDICT**.
- __ВНИМАНИЕ:__ Если вы собираетесь использовать пользовательские уведомления, не забудьте добавить свои сообщения в **intrface.msg**, и настроить их цвет шрифта в ddraw.ini.
- Начиная с версии sfall 4.1, функция `is_iface_tag_active` может также использоваться для проверки **SNEAK**, **POISONED** и **RADIATED** состояний.
- Макросы: `sneak_mode_on`, `sneak_mode_off`.

-----
##### `int get_proto_data(int pid, int offset)`
##### `void set_proto_data(int pid, int offset, int value)`
- Функции используются для изменения данных в прототипах игры (файлы **.pro**), которые Fallout создает в памяти при загрузки карты локации.
- **offset**: смещение относится к смещению в памяти к данным которые вы хотите получить или изменить. Все валидные смещения (константы `PROTO_`) определены в файле **define_extra.h** 
- Изменения не сохраняются в файлы прототипов и не являются постоянными.
- Обычно игра перезагружает копии прототипы при выходе и загрузке новой карты, поэтому все ваши изменения будут потеряны, и вы должны будете вновь внести свои изменения.

-----  
##### `void set_stat_min(int stat, int value)`
##### `void set_stat_max(int stat, int value)`
##### `void set_pc_stat_min(int stat, int value)`
##### `void set_pc_stat_max(int stat, int value)`
##### `void set_npc_stat_min(int stat, int value)`
##### `void set_npc_stat_max(int stat, int value)`
- Эти функции можно использовать для установки допустимых диапазонов для статистики. 
- Значения возвращаемые ванильной функцией `get_critter_stat`, будут ограничены этими установленными диапазонами.
- Функции `set_pc_stat_*` действуют только на игрока, а функции `set_npc_stat_*` только на других криттеров, при этом функции `set_stat_*` действуют на всех.

-----
##### `void set_pc_base_stat(int stat, int value)`
##### `void set_pc_extra_stat(int stat, int value)`
##### `void set_critter_base_stat(object critter, int stat, int value)`
##### `void set_critter_extra_stat(object critter, int stat, int value)`
- Функции позволяют установить базовую и бонусную (extra) статистику прототипа для игрока или криттера.
- Эти функции не проверяют устанавливаемое значение на максимальное/минимальное значение диапазона.
- Автоматически не обновляют производную статистику криттера или игрока.
- Используйте обычную функцию `set_critter_stat`, чтобы правильно установить статистику для криттера.

-----
##### `int get_pc_base_stat(int stat)`
##### `int get_pc_extra_stat(int stat)`
##### `int get_critter_base_stat(object critter, int stat)`
##### `int get_critter_extra_stat(object critter, int stat)`
- Функции позволяют вам получить базовую и бонусную (extra) статистику прототипа игрока или криттера.
- Эти функции не учитывают перки, не делают обрезку на максимальный/минимальный диапазон.
- Используйте обычную функцию `get_critter_stat`, чтобы получить правильно скорректированное значение по перкам и ограниченное по диапазону статистику.

-----
##### `int get_critter_skill_points(object critter, int skill)`
##### `void set_critter_skill_points(object critter, int skill, int value)`
- Функции позволяют напрямую получить или установить количество очков навыка криттера, минуя установленные ограничения или любые бонусы от статов криттера.
- __ВНИМАНИЕ:__: Очки навыков являются частью прототипа, поэтому вызов `set_skill_points` для криттера повлияет на всех криттеров, имеющих тот же прототип.

-----
##### `void set_pyromaniac_mod(int modValue)`
- Функция устанавливает модификатор наносимого урона к перку **Pyromaniac**.
- Значение -1 для модификатора (или любое отрицательное значение), вернет установленный модификатор для перка в значение по умолчанию.
- Также модификатор будет сброшен в значение по умолчанию каждый раз, при выходе в главное меню или когда игрок загружает сохраненную игру.

-----
##### `int get_critical_table(int critterType, int bodyPart, int effectLevel, int valueType)`
##### `void set_critical_table(int critterType, int bodyPart, int effectLevel, int valueType, int setValue)`
##### `void reset_critical_table(int critterType, int bodyPart, int effectLevel, int valueType)`
- Функции используются для изменения критической таблицы (подробнее см. http://falloutmods.wikia.com/wiki/Critical_hit_tables).
- Изменения не сохраняются и сбрасываются при каждой перезагрузке игры на значения по умолчанию или на содержимое файла **CriticalOverrides.ini** (если он существует).
- **critterType**: Номер типа криттера в критической таблице (см. определения `KILL_TYPE_*` в **define.h**) для которого будет происходить изменения.
- **bodyPart**: Номер части тела (см. определения `BODY_HIT_*` в **define_extra.h**).
- **effectLevel**: Уровень эффекта таблицы от 0 до 6.
- **valueType**: Изменяемый параметр в таблице от 0 до 7.
- Функция `reset_critical_table`, позволяет сбросить изменения указанного значения таблицы к значению по умолчанию.
- Эти функции также требуют, чтобы **OverrideCriticalTable** был установлен в ddraw.ini (более неактуально начиная с версии sfall 5.0.7).

-----
##### `int play_sfall_sound(string file, int mode)`
##### `void stop_sfall_sound(int fileID)`
- Функции используются для воспроизведения файлов формата **mp3/wav/wma**.
- **file**: Имя и путь к файлу. Указанный путь является относительным к папке Fallout.
- **mode**: Укажите режим 1 - чтобы зациклить воспроизведение файла, 2 - чтобы заменить текущую фоновую музыку игры на воспроизведение указанного файла в режиме зацикливания, или 0 чтобы воспроизвести файл один раз.
- Функция `play_sfall_sound` возвращает ID для зацикленного воспроизведенного файла, который можно передать обратно в `stop_sfall_sound`, когда вы хотите остановить эффект, иначе функция возвращает 0.
- Все звуковые эффекты будут остановлены при перезагрузке игры.
- Начиная с sfall 4.2.8, вы можете передать значение в аргумент **mode** для уменьшения громкости звука. 
  Для установки громкости необходимо преобразовать число в шестнадцатеричное значение и использовать формат аргумента `0xZZZZ000Y`
  где `ZZZZ` - является значением уменьшения громкости в диапазоне от 0 до 32767 (значение 32767 - полностью приглушено), а `Y` - режим воспроизведения.
- Эти функции не требуют установки опции **AllowDShowSound** в **ddraw.ini**.

-----
##### `void set_pipboy_available(int mode)`
- Позволяет включить или отключить доступность пипбоя в игре для игрока.
- Используйте значения: 0 - чтобы отключить, 1 или 2 чтобы включить (значение 2 не маркирует видео ролик `MOVIE_VSUIT` как "просмотренный").

-----
##### `void inc_npc_level(int pid/string name)`
- Функция устанавливает уровень (стадию) для указанного NPC партийца игрока.
- Принимает в качестве аргумента `PID` номер члена партии или имя NPC (устарело и используется для совместимости с sfall 4.1.5 и более ранними версиями).
- Эта функция игнорирует требования к уровню игрока и минимальную задержку в 3 уровня игрока между повышениями уровня NPC. Это также игнорирует случайный элемент, вне зависимости от настройки опции **NPCAutoLevel**.
- __ВНИМАНИЕ:__ NPC должен быть в партии игрока.

-----
##### `int get_npc_level(int pid/string name)`
- Возвращает текущий уровень (стадия) для указанного NPC партийца игрока.
- Принимает в качестве аргумента `PID` номер члена партии или имя NPC (устарело и используется для совместимости с sfall 4.1.5 и более ранними версиями).
- __ВНИМАНИЕ:__ NPC должен быть в партии игрока.

-----
##### `void set_car_current_town(int town)`
- Устанавливает текущий город (его индекс) нахождения автомобиля игрока.

-----
##### `void force_aimed_shots(int weaponPID)`
##### `void disable_aimed_shots(int weaponPID)`
- Функции позволяют переопределить правило, касающиеся того, какое оружие может иметь или не иметь прицельные атаки. Например, оружие наносящее взрывной урон, обычно не может делать прицельные выстрелы. 
- `force_aimed_shots` позволит оружию делать прицельные выстрелы, даже если обычно оно не может этого делать. 
- `disable_aimed_shots` не позволит оружию делать прицельные выстрелы, даже если оно обычно может это делать.
- **weaponPID**: Номер прототипа оружия к которому нужно применить данное правило. Используйте значение равное 0, для рукопашной атаки (Unarmed).
- __ВНИМАНИЕ:__ Функция `force_aimed_shots` не переопределяет эффект от трейта **Fast Shots**. 
- Список отредактированного оружия не сохраняется при загрузке сохраненной игры, поэтому функции нужно вызывать при каждой перезагрузке.
- Обе эти функции влияют как на игрока, так и на NPC.

-----
##### `void set_bodypart_hit_modifier(int bodyPart, int hitMod)`
- Изменяет модификатор шанса попадания при прицельной атаки в определенные части тела криттера (модификаторы влияют на всех, включая персонаж игрока).
- **bodyPart**: Часть тела. Допустимые идентификаторы частей тела `BODY_HIT_*` определены в define_extra.h.
- Значение части тела `BODY_UNCALLED` не является прицельным модификатором, этот модификатор влияет на общий шанс попадания.
- Изменения не сохраняются и при каждой перезагрузке игры сбрасываются на значения по умолчанию (или на установленные значения опциях **BodyHit_** в ddraw.ini).

-----
##### `int get_bodypart_hit_modifier(int bodyPart)`
- Возвращает текущий модификатор шанса попадания для определенной части тела криттера.

-----
##### `void set_unspent_ap_bonus(int bonusValue)`
- Функция изменяют бонус **AC**, который вы получаете за неиспользованное очко действия **AP** в конце вашего хода в бою.
- Чтобы учесть дробные значения, приведенное значение делится на 4. Поэтому значение по умолчанию равно 4, а не 1.

-----
##### `int get_unspent_ap_bonus()`
- Возвращает текущий установленный бонус к **AC** за неиспользованное очко действия **AP**.

-----
##### `void set_unspent_ap_perk_bonus(int bonusValue)`
- Функция изменяют дополнительный бонус **AC**, даваемый перком **H2H Evade**.
- По умолчанию это значение также равно 4, что эквивалентно удвоению оригинального бонуса.

-----
##### `int get_unspent_ap_perk_bonus()`
- Возвращает текущий установленный бонус к **AC** от перка **H2H Evade**.

-----
##### `int get_ini_setting(string setting)`
- Считывает целочисленное значение из INI-файла расположенного в каталоге игры **Fallout**.
- Функция принимает один строковый аргумент, содержащий имя файла, раздел, ключ и значение по умолчанию разделенные символом `|`, пример: `get_ini_setting("MyConfig.ini|SectionName|KeyName|DefaultValue")`
- Путь к файлу указывается относительно корневого каталога игры, для разделения пути к файлу используйте два символа `\\` (или один `/`).
- Аргумент строки ограничен 1024 символами, для совместимости с более ранними версиями придерживайтесь ограничению имени раздела в 32 символами, имя и путь к файлу не более 63 символа (включая расширение файла).
- Начиная с версии sfall 5.0.8 функция может обращается к **неупакованным** файлам расположенных в файловой системе **Fallout**, для этого первый символ аргумента строки должен содержать символ `:`, путь к файлу указывайте без привязки к имени `.dat` папки. Также может содержать задаваемое значение по умолчанию **DefaultValue**.
- Функцию можно использовать для получения sfall настроек, используя в качестве имени файла **ddraw.ini**. Для версий **sfall 5.0** можно использовать функцию `get_config_setting`.
- При возникновении ошибки, или если файл/ключ не может быть найден, возвращается значение -1 (имейте ввиду, что значение ключа может иметь это значение).

-----
##### `string get_ini_string(string setting)`
- Считывает строковое значение из INI-файла расположенного в каталоге **Fallout**.
- Если ключ не может быть найден, возвращается значение **DefaultValue**, или пустой строки `""` если **DefaultValue** в аргументе был опущен.
- Функция полностью аналогична `get_ini_setting` см. ее описание выше.
- __ВНИМАНИЕ:__ Длина полученной строки не может превышать 1024 символов.

-----
##### `int get_game_mode()`
- Возвращает набор флагов, указывающих, в каком режиме находится игра в данный момент.
- Функция является более гибкой версией чем простая `in_world_map`. 
- Эти флаги аналогичны тем, которые используются в функции `set_shader_mode`.

-----
##### `int get_uptime()`
- Получает текущие количество прошедших тиков с начала включения системы Windows (обертка функция windows `GetTickCount()`). 
- Это полезно для создания эффектов затухания времени в шейдерах, поскольку они уже имеют доступ к текущему счетчику тиков.

-----
##### `bool in_world_map()`
- Возвращает 1, если игрок находится на карте мира, или 0 в любое другое время.
- Полезно только для глобальных скриптов, поскольку обычные скрипты не могут работать на карте мира.

-----
##### `int get_world_map_x_pos()`
##### `int get_world_map_y_pos()`
- Функции возвращает текущие координаты позиции `x` и `y` игрока на карте мира.

-----
##### `void force_encounter(int map)`
- Вызывает встречу с указанной картой.
- Функция может быть вызвана из глобального скрипта во время путешествия по карте мира, так и из обычного скрипта на локальной карте.
- Встреча происходит вскоре после следующего перемещения игрока по карте мира.
- При встрече игрок не получит никакой проверки на навык **Outdoorsman**.
- __ВНИМАНИЕ:__ Принудительная случайная встреча на карте, которая обычно не используется для случайных встреч, может привести к тому, что игрок потеряет машину (если она у него есть). Чтобы избежать этого используйте функцию `force_encounter_with_flags` с установленным флагом `ENCOUNTER_FLAG_NO_CAR`.

-----
##### `void force_encounter_with_flags(int map, int flags)`
- Функция делает то же самое, что и `force_encounter`, но позволяет указать некоторые дополнительные опции (доступные флаги см. в **sfall.h**).

-----
##### `int get_light_level()`
- Получает текущий уровень освещенности (Ambient локальной карты) в диапазоне 0..65536.
- Значение, возвращаемое `get_light_level`, может не полностью совпадать со значением, установленным `set_light_level`, так как `set_light_level` применяет модификаторы от перка **Night Vision**.

-----
##### `void set_map_time_multi(float multi)`
- Регулирует скорость прохождения времени, когда вы путешествуете по карте мира. В качестве аргумента он принимает значение множителя `float`, где 1.0 обычная скорость.
- Функция работает в дополнение к настройке опции **WorldMapTimeMod** в ddraw.ini, и перка **Pathfinder**.
- Например вызов `set_map_time_multi(0.5)`, и наличия двух уровней перка **Pathfinder** приведет к тому, что время на карте мира будет идти со скоростью 25% от обычной.

-----
##### `int get_script(object obj)`
- Принимает указатель на объект и возвращает его `scriptID` (номер строки в **scripts.lst**), или 0, если объект не имеет прикрепленного скрипта.
- Возвращает -1 при ошибке аргумента.

-----
##### `void set_script(object obj, int scriptid)`
- Принимает указатель на объект и номер скрипта в **scriptID**, прикрепляя заданный скрипт к объекту (**scriptID** принимает те же значения, что и `create_object_sid`).
- При инициализации скрипта будет выполняться процедуры `start` и `map_enter_p_proc` прикрепленного скрита.
- Чтобы пропустить выполнение процедуры `map_enter_p_proc` к аргументу номера скрипта **scriptID** вы должны добавить значение флага `0x80000000`.
- При использовании функции на объекте, с уже прикрепленным скриптом, существующий скрипт будет удален.
- __ВНИМАНИЕ:__ Вызов `set_script` на `self_obj` приведет к разного рода странным побочным эффектам, и это следует избегать.

-----
##### `void remove_script(object obj)`
- Принимает указатель на объект и удаляет скрипт из этого объекта.

-----
##### `void set_self(object setObj)`
- Устанавливает (переопределяет) объект `self_obj` для следующего вызова скриптовой функции.
- Это в основном используется для разрешения проблем при вызове ванильных скриптовых функций из глобальных скриптов, которые принимают неявный параметр `self_obj` (например, функция `drop_obj`). Функция `set_self` также может использоваться из обычных скриптов.
- Объект `self_obj` вернется к своему исходному значению после следующего вызова скриптовой функции.
- Использование `set_self(0)` также вернет `self_obj` к исходному значению. Рекомендуется вызывать это после каждого использования `set_self` в обычных скриптах, для того чтобы избежать непредвиденных побочных эффектов.
- Функция также может быть использована для того чтобы получить доступ к локальным переменным скрипта другого объекта или из глобального скрипта.
- __ПРИМЕЧАНИЕ:__ Для корректной работы ванильных функций `use_obj`, `use_obj_on_obj` требуется дважды использовать `set_self`.
- __ВНИМАНИЕ:__ Функции `source_obj`, `target_obj` будут возвращать ноль, если им предшествует вызов `set_self`.

-----
##### `void get_critter_current_ap(object critter)`
##### `void set_critter_current_ap(object critter, int value)`
- Функции позволяют получить или установить текущее количество очков действий (AP) для криттера.
- Функции должны использоваться только во время хода криттера, находящейся в бою.
- Вызов `get_critter_current_ap` вне боя обычно возвращает максимальные AP криттера, но не стоит полагаться на это поведение. В частности, если криттер никогда раньше не вступало в бой, то это скорее всего вернет его базовые AP, игнорируя любые дополнительные бонусы от перков и т. д.

-----
##### `void set_weapon_knockback(object weapon, int type, int/float knockbackValue)`
##### `void set_attacker_knockback(object critter, int type, int/float knockbackValue)`
##### `void set_target_knockback(object critter, int type, int/float knockbackValue)`
- Функции устанавливают значение модификаторов отбрасывания для указанного объекта.
- **type**: Значение аргумента может быть 0 или 1.  
            Если 0, то установленное значение становится абсолютным расстоянием, на которое цель будет отброшена.  
			Если 1, то установленное значение отбрасывания умножается на расстояние, на которое обычно отбрасывает цель.
- Установленные значения модификаторов отбрасывания в аргументе **knockbackValue**, применяются в порядке: `weapon -> attacker -> target`, поэтому оружие с модификатором множителя 2, который владеет установленным абсолютным значением 6, попав в цель с множителем 0.5, отбросит цель на 3 гекса назад.
- __ВНИМАНИЕ__: Функции не отменяют перк "Каменная стена" и нокдауны (knockdown), получаемые от критических ударов. Установленные значения отката не сохраняются и будут сбрасываться при каждой загрузки/новой игры.

-----
##### `void remove_weapon_knockback(object weapon)`
##### `void remove_attacker_knockback(object critter)`
##### `void remove_target_knockback(object critter)`
- Функции удаляют установленный модификатор отбрасывания у объекта.

-----
##### `void mod_skill_points_per_level(int bonus)`
- Модифицирует (adjust) значение получаемых очков умений, которые получает игрок при повышении уровня.
- Аргумент **bonus** принимает значение в диапазоне от -100 до 100.
- Значение не сохраняется и будет каждый раз сбрасываться при загрузки/новой игры.

-----
##### `void set_perk_level_mod(int modValue)`
- Функция устанавливает модификатор в диапазоне от +25 до -25, который добавляется или вычитается из уровня игрока для определения того, какие перки можно будет выбрать.

-----
##### `void set_perk_freq(int value)`
- Устанавливает количество уровней между получением каждого нового перка.
- Установка значения аргумента в 0, вернет значение по умолчанию для игры.
- __ВНИМАНИЕ:__ Функция переопределяет эффект от трейта **Skilled**.
- Установленное значение не сохраняется в сохраненную игру, поэтому функцию нужно вызывать каждый раз при загрузке сохраненной игры.

-----
##### `object get_last_attacker(object critter)`
- Функция возвращает последнего криттера, которое намеренно совершило атаку на другого криттера.
- Если никакой криттер не совершал или не получил атаку, функция вернет 0.
- Функция работает только на время боя, вне боя это всегда будет возвращать 0.

-----
##### `object get_last_target(object critter)`
- Функция возвращает последнего криттера, на которого была совершена атака.
- Функция работает только во время боя, вне боя это всегда будет возвращать 0.

-----
##### `void set_base_hit_chance_mod(int max, int mod)`
- Изменяет максимальный предел вероятности попадания в цель, и модификатор к шансу попадания для игрока.
- **max**: Заменяет 95% предел шанса вероятности попадания (так что вы можете установить 100% максимальный шанс), любое отрицательное значение пропустит установку.
- **mod**: Добавит столько процентов к шансу попадания (например, если ваш шанс равен 50%, а значение **mod** 20, то фактический процент шанса составит 70%).

-----
##### `void set_hit_chance_max(int max)`
- В отличее от `set_base_hit_chance_mod` функция устанавливает только максимальный предел шанса вероятности попадания в диапазоне от 0 до 999.

-----
##### `void set_critter_hit_chance_mod(object critter, int max, int mod)`
- То же самое, что и `set_base_hit_chance_mod`, но модификаторы применяется только к определенному криттеру.

-----
##### `void set_base_pickpocket_mod(int max, int mod)`
- Изменяет максимальный шанс на успех, и модификатор шанса для каждой попытки кражи для игрока.
- **max**: Заменяет 95% предел шанса на успех кражи (так что вы можете установить 100% максимальный шанс), любое отрицательное значение пропустит установку.
- **mod**: Добавит столько процентов к каждому шансу на успех (например, если ваш шанс равен 50%, а значение **mod** 20, то фактический процент успеха составит 70%).

-----
##### `void set_pickpocket_max(int max)`
- В отличее от `set_base_pickpocket_mod` функция устанавливает только максимальный предел шанса кражи в диапазоне от 0 до 999.

-----
##### `void set_critter_pickpocket_mod(object critter, int max, int mod)`
- То же самое, что и `set_base_pickpocket_mod`, но модификаторы применяется только к определенному криттеру.

##### `void set_skill_max(int max)`
- Устанавливает максимальный верхний предел для навыков, в диапазоне от 0% до 300%.

-----
##### `void set_base_skill_mod(int mod)`
- Функция устанавливает модификатор для навыков.

-----
##### `void set_critter_skill_mod(object critter, int mod)`
- Функция устанавливает модификатор для навыков к определенному криттеру.

-----
##### `int get_window_under_mouse()`
- Возвращает номер идентификатора окна **winID**, находящегося под курсором указателя мыши.

-----
##### `void reg_anim_combat_check(int state)`
- Позволяет выполнять все функции `reg_anim_*` в бою (включая ванильные функции), если в аргумент функции передано значение 0.
- Каждый раз автоматически сбрасывается в конце каждого фрейма выполнения скриптов, поэтому это нужно вызывать перед блоком кода `reg_anim_begin() ... reg_anim_end()`.

---
**Добавлено несколько дополнительных функций `reg_anim_*`. Все они работают по той же схеме, что и ванильные функции, и используют тот же базовый код**.


##### `void reg_anim_destroy(object obj)`
- Указанный объект уничтожится по окончании текущей последовательности анимации.

-----
##### `void reg_anim_animate_and_hide(object obj, int animID, int delay)`
- Аналогично функции `reg_anim_animate`, но объект будет автоматически скрыт после последнего кадра анимации (но не уничтожаться).
- **delay**: Задержка до выполнения указанной анимации в аргументе **animID**, значение -1 выполнит анимацию сразу после того как закончится предыдущая анимация последовательности. 

-----
##### `void reg_anim_light(object obj, int light, int delay)`
- Изменяет освещение любого объекта.
- **light**: Задает радиус света в диапазоне 0..8, и его интенсивность от 0 до 65535, для указания уровня интенсивности необходимо использовать старшие 2 байта (пример: `0xFFFF0008` где интенсивность 65535 и радиус 8). Если старшие 2 байта равны 0, то интенсивность не изменяется.

-----
##### `void reg_anim_change_fid(object obj, int fid, int delay)`
- Это работает точно так же как и функция `art_change_fid_num`, но в анимируемой последовательности `reg_anim`.

-----
##### `void reg_anim_take_out(object obj, int weaponCode, int delay)`
- Воспроизводит анимацию "достать оружие" указанного номера оружия в аргументе **weaponCode** (см. определения `WPN_ANIM_*` в файле **define_extra.h**).
- Наличие такого типа оружия в инвентаре криттера не обязательно.

-----
##### `void reg_anim_turn_towards(object obj, int tile/target, int delay)`
- Заставляет объект изменить направление взгляда к указанному номеру гекса, или объекту.

-----
##### `void reg_anim_callback(procedure proc)`
- Добавляет указанную процедуру в список последовательности анимации и выполняет ее в зарегистрированной последовательности.

----
##### reg_anim_animate_and_move `макрос`
`void sfall_func4("reg_anim_animate_and_move", object obj, int tile, int animID, int delay)`
- Воспроизводит заданную анимацию с одновременным перемещением объекта к указанному номеру гекса.
- **delay**: Задержка до выполнения указанной анимации в аргументе **animID**, значение -1 выполнит анимацию сразу после того как закончится предыдущая анимация в последовательности. 

-----
##### `int/array metarule2_explosions(int arg1, int arg2, int arg3)`
- Функции позволяющие динамически изменять некоторые параметры взрыва (дальняя атака).
- Все измененные параметры автоматически возвращаются в состояние "по умолчанию" после каждого действия атаки.
- Определения макросов этих функций доступны в **sfall.h** и описаны здесь ниже.

-----
##### `void set_attack_explosion_pattern(x, y)`
- Currently `y` is not used and `x` means: 1 - reduced explosion pattern (3 effects are spawned instead of 7), 0 - full pattern.

-----
##### `void set_attack_explosion_art(x, y)`
- `y` is not used and `x` is a misc frame ID (last 3 bytes, without object type) to use for the next explosion.

-----
##### `void set_attack_explosion_radius(x)`
- Изменяет радиус взрыва, при котором взрыв поражает вторичные цели для следующей атаки (эксперементально максимальный радиус ограничен около 8 гексов).

-----
##### `void set_attack_is_explosion_fire`
- If you call this right before using a weapon with fire damage type (e.g. in `HOOK_AFTERHITROLL`), it will produce explosion effects (and radius damage) just like "explosion" type, but all targets will still receive fire damage.

-----
##### `void set_explosion_radius(grenade, rocket)`
- Устанавливает постоянный радиус взрыва для гранат и/или ракет. 
- Передача значения 0 означает отсутствие изменения соответствующего радиуса.
- Измененный радиус будет сбрасываться каждый раз, когда игрок перезагружает игру.

-----
##### `array get_explosion_damage(itemPid)`
- Returns array of the minimum and maximum damage of the explosive item.

-----
##### `void set_dynamite_damage(minDmg, maxDmg)`
- Sets the minimum and maximum damage for Dynamite.
- changed damage will be reset each time the player reloads the game.

-----
##### `void set_plastic_damage(minDmg, maxDmg)`
- Sets the minimum and maximum damage for Plastic Explosives.
- changed damage will be reset each time the player reloads the game.

-----
##### `void set_explosion_max_targets(x)`
- Sets the maximum number of additional targets for an explosion, valid range: 1..6 (default is 6)

-----
##### `void register_hook_proc(int hookId, procedure proc)`
- Работает так же, как `register_hook`, но позволяет указать (вместо `start`), какую процедуру использовать для данного скрипта крючка.
- В аргумент **proc** должна быть передана ссылка на процедуру скрипта так же, как вы передаете процедуры таким функциям, как `gsay_option`, `giq_option` и т.д. (имя процедуры без кавычек).
- Используйте 0 (ноль) вместо ссылки на процедуру, чтобы отменить регистрацию крючка из текущего глобального скрипта.
- Используйте эту функцию только в глобальных скриптах.
- Обратитесь к файлу **HookScripts.md** для более подробной информации.

-----
##### `void register_hook_proc_spec(int hookId, procedure proc)`
- Работает так же, как `register_hook_proc`, но позволяет зарегистрировать сценарий в конце всей цепочки выполнения (т.е. скрипт будет выполняться после всех ранее зарегистрированных скриптов того же самого типа крючка, включая скрипт `hs_*.int`).
- Чтобы отменить регистрацию крючка, используйте функцию `register_hook_proc`.

-----
##### `string message_str_game(int fileId, int messageId)`
- Работает точно так же, как функция `message_str`, за исключением того, что вы получаете сообщения из файлов расположенных в папке **Game** (т.е. `text\<language>\game\`).
- Используйте макросы `GAME_MSG_*` или `mstr_*` из **sfall.h** для использования определенного msg-файла.
- Дополнительные игровые msg-файлы, добавленные с помощью опции **ExtraGameMsgFileList** в **ddraw.ini**, будут иметь последовательные идентификаторы файлов **fileId**, начиная с `0x2000` до `0x2FFF` (например, если вы установите `ExtraGameMsgFileList=foo,bar` так, то **foo.msg** будет связан номером с `0x2000`, а **bar.msg** с `0x2001`).
- Если в опции **ExtraGameMsgFileList** файлу будет присвоен определенный номер, тогда его идентификатор файла будет иметь значение `0x2000` + присвоенный номер, а следующий за ним файл получит следующий номер (например, `ExtraGameMsgFileList=foo,bar:2,foobar`, то **bar.msg** будет связан с `0x2002`, а **foobar.msg** с `0x2003`), поэтому не допускайте присваивание номеров в середине цепочки.

-----
##### `int sneak_success()`
- Возвращает 1, если игрок в данный момент крадется, и последняя попытка красться (бросок против навыка) была успешной, или 0 в противном случае.
- Это вызывает внутреннюю функцию движка, которая используется для определения диапазона восприятия криттеров (которую вы можете переопределить с помощью `HOOK_WITHINPERCEPTION` крючка).

-----
##### `int tile_light(int elevation, int tileNum)`
- Возвращает интенсивность света на данной плитке в диапазоне от 0 до 65536.

-----
##### `int get_tile_fid(int tile)`
- Возвращает FID плитки карты по указанному гексу нулевого уровня карты.
- Аргумент **tile** начиная с версии sfall 5.0.5 может использоваться ввиде шаблона **0xMEXXTTTT**, для того чтобы указать новые режимы работы.
- Где первое 4-х битовое поле `M` позволяет указать то, что вы хотите получить, значение: 0 - FID земли (по умолчанию), 1 - FID крыши, 2 - одновременно FID крыши и земли.
- Второе 4-х битовое поле `E` позволяет указать требуемый уровень карты (0-2). Поля `TTTT` используются для указания требуемой плитки.
- Следующие новые макросы `get_tile_ground_fid`, `get_tile_roof_fid` доступны в **sfall.h**.

-----
##### `object obj_blocking_line(object objFrom, int tileTo, int blockingType)`
- Возвращает первый объект, который блокирует прямой путь от объекта **objFrom** к плитке **tileTo** с помощью указанного типа блокировки.
- **blockingType**: Тип используемой функции блокировки (см. константы `BLOCKING_TYPE_*` в **sfall.h**).
- Если путь свободен (функция не встретила указанный тип блокиратора) возвращается 0.
- Объект **objFrom** всегда исключается из вычислений, но он обязан быть действительным объектом.

-----
##### `object obj_blocking_tile(int tileNum, int elevation, int blockingType)`
- Возвращает первый объект, блокирующий заданную плитку с помощью указанного типа (функции) блокировки, или 0, если плитка свободна.

-----
##### `array tile_get_objs(int tileNum, int elevation)`
- Возвращает массив всех объектов на заданной плитке.
- Это будет включать любые скрытые, мертвые или системные объекты карты (например, курсор), поэтому обязательно проверяйте объекты при переборе массива.

-----
##### `array party_member_list(int includeHidden)`
- Возвращает массив объектов всех текущих членов группы игрока, это также будет содержать и сам объект игрока (`obj_dude`).
- **includeHidden**: 0 - будут возвращены только живые и видимые объекты криттеров, 1 - все объекты, включая багажник и т.д.

-----
##### `array path_find_to(object objFrom, int tileTo, int blockingType)`
- Возвращает кратчайший путь к заданной плитке в виде массива направлений плиток (0..5) с использованием заданного типа (функции) блокировки.
- Длина массива равна количеству шагов для перемещения.
- Пустой массив означает, что указанная плитка не может быть достигнута (т.е. путь блокирован).

-----
##### `object create_spatial(int scriptID, int tile, int elevation, int radius)`
- Создает новый пространственный (spatial) скрипт с заданным **scriptID**, на заданной плитке и радиусом.

-----
##### `int art_exists(int artFID)`
- Проверяет существует ли указанный **artFID** в игре.
- Полезно, когда вы хотите проверить, может ли криттер использовать определенное оружие: `art_exists((artFid bwand 0xFFFF0FFF) bwor (weaponAnim * 0x1000))`.

-----
##### `int obj_is_carrying_obj(object invenObj, object itemObj)`
- Возвращает количество предметов **itemObj** в инвентаре объекта **invenObj**, (обратите внимание, что оба аргумента являются указателями на объект).
- Полезно при работе с разными стеками одного и того же предмета, так `obj_is_carrying_obj_pid` просто возвращает общее количество предметов для всех стеков с тем-же **PID** номером.

-----
##### `any get_config_setting(string section, string key, any default)`
- Получает значение из текущего конфигурационного INI-файла sfall (т.е. из **ddraw.ini**).
- **section**: Имя секции в конфигурационном файле.
- **key**: Имя опции в конфигурационном файле.
- **default**: Возвращаемое значение по умолчанию (от типа зависит возвращаемый тип значения ключа).
- __ВНИМАНИЕ__: Функция возвращает -1 при ошибке агрумента.

-----
##### `int set_config_setting(string section, string key, any value)`
- Записывает значение в текущий конфигурационный INI-файл sfall (т.е. в **ddraw.ini**).
- **section**: Имя секции в конфигурационном файле.
- **key**: Имя опции в конфигурационном файле.
- **value**: Значение устанавливаемого ключа, поддерживается любой тип значения.
- Функция возвращает -1, если не удалось установить значение или при ошибке агрумента, иначе 0.

-----
##### `int load_shader(string shaderFile)`
- Функция загружает и возвращает идентификатор загруженного шейдера.
- Загруженный ID-номер шейдера должен передаваться в качестве аргумента всем шейдерным функциям, этот ID и будет действовать до тех пор, пока игрок не загрузит сохраненную игру, не выйдет в главное меню, или не воспользуется функцией `free_shader`.
- **shaderFile**: Аргумент принимает путь к файлу шейдера `.fx` расположенного в директории `<GameRoot>\<master_patches>\shaders\`, начиная с версии `sfall v5.0.8` функция может загрузить файл находящийся в файловой системе игры.

-----
##### `void free_shader(int shaderID)`
- Удаляет (освобождает) шейдер с указанным номером ID. Это прекратит выполнение шейдера графической системой игры.

-----
##### `void set_shader_mode(int shaderID, int mode)`
- Функция указывает, когда необходимо включать/отключать загруженный шейдер.
- **shaderID**: Идентификационный номер загруженного шейдера.
- **mode**: Параметр представляет собой набор из 32 флагов, определяющих режимы интерфейсов на которых шейдер будет отключен, при этом если установлен бит 32, то в этом случае шейдер будет активен только на данных режимах. Список флагов всех определений режимов см. в **sfall.h**.
__ВНИМАНИЕ__: Помните, что режимы игры накладываются друг на друге. Если игрок открывает меню персонажа, находясь в бою, игра все равно будет считать, что игрок находится в бою.

-----
##### `void set_shader_type(int shaderID, int type)`
- Устанавливает тип слоев для шейдера, на которые он будет оказывать влияние при обработке игровой картинки.
- **shaderID**: Идентификационный номер загруженного шейдера.
- **type**: Набор флагов для шейдинга.  
    0x0 - шейдер будет обрабатывать все слои (значение по умолчанию для всех шейдеров)  
    0x1 - слой указателя мышки/курсора  
    0x2 - слой интерфейса (сюда входит также статичные экраны, и игровое видео)  
    0x4 - слой локальной карты

-----
##### `int get_shader_version()`
- Функция позволяет узнать используемую версию шейдеров поддерживаемую видеокартой игрока.
- Возможные значения версий: 11, 12, 13, 14, 20, 21 и 30.

-----
##### `int force_graphics_refresh()`
- Функция заставляет экран игры перерисовываться в те моменты, когда обычно это не происходит.
- Если вы используете анимированные шейдеры, рекомендуется включить эту опцию.

---
### Некоторые доступные математические и строковые функции:


##### `array string_split(string text, string splitChar)`
- Принимает строку и символ разделитель, и ищет в строке все экземпляры разделителя и возвращает временный массив, заполненный частями строки, разделенными в каждом экземпляре.
- Если в качестве разделителя указать пустую строку, то строка будет разбита на отдельные символы.
- Это можно использовать для поиска подстроки в строке, например, так: `strlen(get_array(string_split(haystack, needle), 0))`

-----
##### `string substr(string text, int start, int length)`
- Возвращает подстроку из переданной строки, начиная с **start** и до **length** символов. Первая позиция символа начинается с 0 (ноль).
- Если **start** отрицательный - это указывает на начальную позицию от конца строки, например: `substr("test", -2, 2)` это вернет последние 2 символа, т.е. "st".
- Если **length** отрицательный - это означает, то столько символов будет опущено то конца строки, например: `substr("test", 0, -2)` это вернет строку без последних 2-х символов, т.е. "te".
- Если **length** равен нулю - возвращается строка от начальной позиции до конца строки (новое поведение для sfall 4.2.2).

-----
##### `int strlen(string text)`
- Возвращает длину строки.

-----
##### `string sprintf(string format, any value)`
- Форматирует заданное значение, используя стандартный синтаксис функции `printf` (подробности формата см. в разделе `printf` языка С). 
- Функция ограничена форматированием только 1-го значения, для большего количества аргументов используйте функцию `string_format`.
- Длина строки формата ограничена 1024 символами.
- Может использоваться для получения символа по `ASCII` коду `%c`.

-----
##### `int atoi(string text)`
##### `float atof(string text)`
- Преобразует и возвращает целое число или число с плавающей запятой (функция `atof`) из его строкового предоставления.
- Если в предоставляемой строке не было найдено число для преобразования, функции возвращают нулевое значение.

-----
##### `int charcode(string text)`
- Возвращает код `ASCII` для первого символа в заданной строке.

-----
##### `div` operator (unsigned int division)
- Используйте это в качестве оператора деления, пример: `3 + (20 div 5)`.
- Если и делимое, и делитель - являются целыми числами, они будут рассматриваться как целые без знака.
- Если один из аргументов имеет тип `float`, то `div` будет выполнять знаковые деление так же, как и ванильный оператор деления.

-----
##### `^` operator (exponentiation)
- Используйте как любой другой арифметический оператор, например `5 ^ ( 1 / 3)`.
- Если экспонента - целое число, то можно использовать отрицательное основание, иначе получится `NaN` с отрицательным основанием.
- Если оба аргумента являются целыми числами, то результатом будет целое число

-----
##### `float log(float x)`
- Возвращает натуральный логарифм **x**.

-----
##### `float exponent(float x)`
- `e ^ x`.

-----
##### `int ceil(float x)`
- Округляет **x** до ближайшего целого числа, которое не меньше **x**.

-----
##### `int round(float x)`
- Округляет **x** до ближайшего целого числа.

-----
##### `float sqrt(float x)`
- Возвращает квадратный корень из **x**.

-----
##### `int/float abs(int/float x)`
- Возвращает абсолютное (положительное) значение **x**.

-----
##### `float sin(float x)`
- Возвращает синус **x**.

-----
##### `float cos(float x)`
- Возвращает косинус **x**.

-----
##### `float tan(float x)`
- Возвращает тангенс угла **x**.

-----
##### `float arctan(float x, float y)`
- Возвращает арк-тангенс угла **x**.
- **y** не используется, просто передайте 1.


------------------------------------
   SFALL_FUNCX METARULE FUNCTIONS
------------------------------------

##### `any sfall_funcX(string funcName, ...)`
- Эти универсальные опкоды позволяют использовать дополнительные скриптовые функции добавляемые в игру с помошью sfall.
- Существуют версии этого опкода с разным количеством аргументов, до 9 включительно.
- Первым из аргументом всегда является именем функции (типа `string`).
- Также опкоды операций имеют возвращаемые значения, при ошибке чаще всего функции возвращают значение -1.
- Аргументы помеченные символом звездочки (*) являются опциональными.

----
#### get_metarule_table
`array sfall_func0("get_metarule_table")`
- Возвращает массив с именами всех доступных на данный момент скриптовых функций `sfall_funcX`.

----
#### metarule_exist
`bool sfall_func1("metarule_exist", string metaruleName)`
- Возвращает `True`, если указанное имя функции `sfall_funcX` существует в текущей версии sfall.

----
#### spatial_radius
`int sfall_func1("spatial_radius", object obj)`
- Возвращает радиус пространственного (spatial) скрипта, связанного с данным фиктивным (dummy) объектом, созданный с помощью функции `create_spatial`.
- **obj**: Фиктивный объект к которому присоединен пространственный скрипт. 

----
#### critter_inven_obj2
`object sfall_func2("critter_inven_obj2", object invenObj, int type)`
- Функция выполняет тоже самое, что и оригинальная `critter_inven_obj`, но позволяет правильно получить предмет в руке неактивного слота игрока.

----
#### intface_redraw
`void sfall_func0("intface_redraw")`  
`void sfall_func1("intface_redraw", int winType)`
- Перерисовывает основной интерфейс игры, полезно после прямого изменения текущего оружия или статистики игрока, чтобы отразить изменения.
- **winType**: Номер типа окна интерфейса для перерисовки (см. константы `WINTYPE_*` в **sfall.h**), или передайте -1 для перерисовки всех окон интерфейсов.

----
#### intface_hide
`void sfall_func0("intface_hide")`  
`void sfall_func1("intface_hide", int winType)`
- Скрывает основную панель интерфейса игрока, или указанное окно интерфейса.
- **winType**: Номер типа окна интерфейса (см. константы `WINTYPE_*` в **sfall.h**).
- Связанные макросы: `interface_hide(winType)`.

----
#### intface_show
`void sfall_func0("intface_show")`  
`void sfall_func1("intface_show", int winType)`
- Показывает основную панель интерфейса игрока, или указанное окно интерфейса.
- **winType**: Номер типа окна интерфейса (см. константы `WINTYPE_*` в **sfall.h**)
- __ПРИМЕЧАНИЕ:__ В функции `intface_hide` без аргументов, применяется счетчик количество сокрытий, поэтому чтобы отобразить окно, должно быть вызвано тоже самое количество раз, сколько было использовано функций `intface_hide`.
- Связанные макросы: `interface_show(winType)`.

----
#### intface_is_hidden
`int sfall_func0("intface_is_hidden")`
- Возвращает 1, если панель интерфейса в настоящее время скрыта, 0 в противном случае.

----
#### exec_map_update_scripts
`void sfall_func0("exec_map_update_scripts")`
- Выполняет процедуру обработчик скриптов `map_update_p_proc` для всех объектов на карте, включая любые sfall скрипты с этим обработчиком.

----
#### floor2
`int sfall_func1("floor2", float value)`
- Функция выполняет округление вещественного значения и возвращает наибольшее целочисленное значение, которое не больше, чем значение **value**.
- В отличее от оригинальной BIS функции `floor`, эта функция правильно округляет число для отрицательных значений.
- __ВНИМАНИЕ:__ Оригинальная функция `floor` выполняет округление к нулю (т.е. отбрасывает дробную часть числа, наподобие функция `trunc` в C/C++), может использоваться в качестве преобразования типа `float` к `int`.

----
#### item_weight
`int sfall_func1("item_weight", object obj)`
- Получает текущий вес объекта.

----
#### get_outline
`int sfall_func1("get_outline", object obj)`
- Получает текущий цвет `OUTLINE_*` контура подсветки объекта, или 0 если объект не выделяется.

----
#### set_outline
`void sfall_func2("set_outline", object obj, int color)`
- Устанавливает цвет подсветки контура объекта.
- **color**: Цвет контура. Значения макросов `OUTLINE_*` определены в **sfall.h**, 0 означает отключение контура подсветки.
- Также можно установить пользовательский цвет из игровой палитры, установив значение индекса цвета палитры на значение второго байта: `0xCC00`, где `CC` - индекс палитры (доступно с sfall 4.2.7)
- Используйте функцию `tile_refresh_display` после изменения контура объектов для обновления сцены карты.

----
#### outlined_object
`object sfall_func0("outlined_object")`
- Возвращает объект, который в данный момент выделяется/подсвечивается при наведении на него курсором мышки.

----
#### get_flags
`int sfall_func1("get_flags", object obj)`
- Получает текущее значение флагов объекта (доступные флаги см. в файле **define_extra.h**).

-----
#### set_flags
`void sfall_func2("set_flags", object obj, int flags)`
- Устанавливает флаги для объекта.
- Все флаги переписываются с заданным целым числом, поэтому сначала получите текущие флаги с помощью `get_flags` и используйте `bwor`, `bwand` для установки или удаления битового флага.

----
#### tile_refresh_display
`void sfall_func0("tile_refresh_display")`
- Перерисовывает игровую карту (тайлы, стены, объекты и т.д.).

----
#### set_dude_obj
`object sfall_func1("set_dude_obj", obj critter)`
- Берет под контроль объект указанного криттера. Функция `dude_obj` будет возвращать объект установленного криттера.
- Передача в аргумент 0, вернет управление обратно к исходному объекту игрока.

----
#### real_dude_obj
`void sfall_func0("real_dude_obj")`
- Возвращает указатель на исходный объект персонажа игрока, вне зависимости что было установлено функцией `set_dude_obj`.

----
#### get_ini_config
`array sfall_func1("get_ini_config", string config)`  
`array sfall_func2("get_ini_config", string config, bool searchDB)`
- Загружает указанный INI-файл в память, и возвращает идентификатор на постоянный ассоциативный массив (типа `lookup map`), в котором ключи соответствуют названиям секций, а их значения это идентификатор на постоянный ассоциативный массив, в котором в строковом типе содержатся ключи и значения секции, пример доступа к значению: `value = iniArray["section"]["option"]` или `value = iniArray.section_name.option_name`.
- **config**: Имя и путь к INI-файлу.
- **searchDB**: Передача значение `True` укажет, что поиск файла будет происходить в файловой системе Fallout (т.е. поиск будет осуществлен во всех DAT-файлах и папках игры).
- При поиске в файловой системе путь к файлу указывается так, как расположен сам файл внутри файловой системы, без привязки к имени `.dat` файла или его папки, например: `cfg\\mymod.ini`.
- Используйте функцию, если вам необходимо хранить INI-файл в .dat файле, или требуется частый доступ его содержимому.
- Если вам более не нужен будет доступ к содержимому, удалите каждый созданный массив и его под-массивы с помощью функции `free_array`, иначе это просто будет занимать память.
- Связанные макросы: `get_ini_config_dat`, `free_ini_config`.

----
#### get_ini_sections
`array sfall_func1("get_ini_sections", string file)`
- Возвращает временный массив имен всех разделов в указанном INI-файле.
- **file**: Путь и имя к файлу относительно корневого каталога игры.
- Для возможности доступа к файлам расположенных в файловой системе Fallout, первый символ аргумента **file** должен содержать символ `:`, в этом случае путь к директории файла указывайте без привязки к имени `.dat` папки. (sfall 5.0.8).

----
#### get_ini_section
`array sfall_func2("get_ini_section", string file, string section)`
- Возвращает временный ассоциативный массив ключей и значений указанной секции в INI-файле.
- **file**: Путь и имя к файлу относительно корневого каталога игры.
- Для возможности доступа к файлам расположенных в файловой системе Fallout, первый символ аргумента **file** должен содержать символ `:`, в этом случае путь к директории файла указывайте без привязки к имени `.dat` папки. (sfall 5.0.8).
- __ПРИМЕЧАНИЕ:__ Все ключи и их значения будут иметь тип `string`.

----
#### get_ini_setting_ex
`int sfall_func4("get_ini_setting", string section, string key, any default, string file)`  
`int sfall_func5("get_ini_setting", string section, string key, any default, string file, bool searchDB)`
- Получает и возвращает значение из INI-файла находящегося в каталоге игры Fallout, или в его файловой системе.
- **section**: Имя секции в файле.
- **key**: Имя опции из которой будет возвращено значение.
- **default**: Возвращаемое значение и его тип по умолчанию (поддерживаются типы `int`, `float`, `string`).
- **file**: Имя конфигурационного файла.
- **searchDB**: Передача значение `True` укажет, что поиск файла будет происходить в файловой системе Fallout. Не открывает INI-файлы упакованные в DAT.
- __ВНИМАНИЕ:__ Возвращает -1 при ошибке типа аргумента.

----
#### set_ini_setting
`int sfall_func2("set_ini_setting", string setting, int/string value)`
- Записывает целое число или строковое значение в INI-файл в каталоге Fallout. Если INI-файл не существует, он будет создан.
- Аргумент **setting** полностью соответствует формату функции `get_ini_setting`, где вам требуется разделять имя файла, секцию и ключ символом `|`.
- Поддерживает запись в INI-файлы расположенные в файловой системе Fallout (см. описание `get_ini_setting`).
- Возвращает значение -1 при ошибке записи, иначе 0.

----
#### set_ini_setting_ex
`int sfall_func4("set_ini_setting", string section, string key, any value, string file)`  
`int sfall_func5("set_ini_setting", string section, string key, any value, string file, bool searchDB)`
- Записывает значение в INI-файл находящегося в каталоге игры Fallout, или в его файловой системе. Если INI-файл не существует, он будет создан.
- **section**: Имя секции в файле.
- **key**:  Имя опции в которую будет произведена запись значения.
- **value**: Записываемое значение, поддерживаются типы `int`, `float`, `string`.
- **file**: Имя конфигурационного файла.
- **searchDB**: Передача значение `True` укажет, что поиск и запись в файл будет происходить в файловой системе Fallout. В этом случае путь к директории файла указывайте без привязки к имени `.dat` папки.
- Возвращает значение -1 при ошибке записи, иначе 0.

----
#### car_gas_amount
`int sfall_func0("car_gas_amount")`
- Возвращает текущее количество топлива в машине игрока (от 0 до 80000).
- Чтобы изменить количество топлива, используйте функцию: `metarule(METARULE_GIVE_CAR_GAS, amount)`, аргумент **amount** может быть положительным или отрицательным.

----
#### set_car_intface_art
`void sfall_func1("set_car_intface_art", int artIndex)`
- Изменяет арт интерфейса для изображения автомобиля в интерфейсе карты мира. Индекс в LST-файле, по умолчанию для игры 433.
- __ВНИМАНИЕ:__ Функцию следует вызывать до перехода к карте мира.

----
#### get_cursor_mode
`int sfall_func0("get_cursor_mode")`
- Возвращает текущий режим курсора: 0 - movement cursor, 1 - command cursor, 2 - targeting cursor (см. константы определения `CURSOR_*` в **sfall.h**).
- Номера режимов с 4-го по 10-й режим, это навыки **Skilldex** (желтый курсор перекрестия).

----
#### set_cursor_mode
`void sfall_func1("set_cursor_mode", int mode)`
- Устанавливает текущий режим курсора. Режим определяет в каком режиме будет находится игра. 

----
#### get_cursor_type
`int sfall_func0("get_cursor_type")`
- Возвращает текущий тип формы курсора (см. константы определения `CURSOR_TYPE_*` в **sfall.h**).  

----
#### display_stats
`void sfall_func0("display_stats")`
- Обновляет данные статистики игрока в окне отображения инвентаря или в интерфейсе персонажа игрока.
- __ВНИМАНИЕ:__ Это работает только при открытом окне интерфейса.

----
#### lock_is_jammed
`int sfall_func1("lock_is_jammed", object)`
- Возвращает 1, если замок контейнера или другого объекта в данный момент заклинило, 0 - в противном случае.

----
#### unjam_lock
`void sfall_func1("unjam_lock", object)`
- Немедленно снимает блокировку заклинившего замка объекта, не дожидаясь следующего дня, или выхода с карты и возвращения через 24 часа.
- __ВНИМАНИЕ:__ Это не будет работать при вызове из процедуры `use_skill_on_p_proc`.

----
#### set_unjam_locks_time
`void sfall_func1("set_unjam_locks_time", int time)`
- Устанавливает, через сколько часов (до 720 часов, по умолчанию 24 часа) заклинившие замки будут разблокированы, когда игрок покинет карту.
- Это автоматически отключит возможность разблокировки заклинивших замков, которое происходит в полночь, когда игрок находится на карте.
- Передача значения 0 полностью отключит механизм автоматической разблокировки замков.
- Механизм автоматической разблокировки будет сбрасываться каждый раз, когда игрок перезагружает игру.

----
#### get_map_enter_position
`array sfall_func0("get_map_enter_position")`
- Возвращает массив данных о положении игрока `[tile, elevation, rotation]`, при входе на карту через сетки выхода (exit grids).
- При входе с карты мира значение `tile` будет равно -1.
- __ВНИМАНИЕ:__ Это должно быть вызвано в процедуре `map_enter_p_proc` для получения корректных данных о положении.

----
#### set_map_enter_position
`void sfall_func3("set_map_enter_position", int tile, int elevation, int rotation)`
- Переопределяет позицию игрока при входе на карту через сетку выхода (exit grids).
- Установка аргумента **tile** в 0 поместит игрока на стартовый гекс карты (тайл по умолчанию и уровень высоты).
- __ВНИМАНИЕ:__ Установка будет работать только в процедуре `map_enter_p_proc`.

----
#### set_rest_heal_time
`void sfall_func1("set_rest_heal_time", int minutes)`
- Устанавливает временной интервал в минутах для лечения во время отдыха. По умолчанию 180.
- Временной интервал будет сбрасываться каждый раз, когда игрок перезагружает игру.

----
#### set_rest_mode
`void sfall_func1("set_rest_mode", int mode)`
- Устанавливает битовые флаги для режима отдыха на карте (см. описание констант `RESTMODE_*` режимов в **sfall.h**).
- Передача 0 в аргумент **mode** приводит к сбросу режима. Это также будет сбрасываться каждый раз, когда игрок перезагружает игру.

----
#### attack_is_aimed
`int sfall_func0("attack_is_aimed")`
- Возвращает 1, если выбран режим прицельной атаки, 0 - в противном случае.

----
#### set_iface_tag_text
`void sfall_func3("set_iface_tag_text", int tag, string text, int color)`
- Устанавливает текстовые сообщения и его цвет для пользовательских уведомлений (boxes) в интерфейсе, без необходимости добавления сообщений в файл **intrface.msg** и установки цветов для шрифта в ddraw.ini.
- **tag**: Значение такое же, как и для `show_iface_tag`, `hide_iface_tag` и `is_iface_tag_active`. Диапазон допустимых значений от 5 до (4 + значение **BoxBarCount** в ddraw.ini) или номер последнего пользовательского бокса, добавленного с помощью функции `add_ifaca_tag`.
- **text**: Текст уведомления (ограничено 19 символами).
- **color**: Доступные цвета 0 - green, 1 - red, 2 - white, 3 - yellow, 4 - dark yellow, 5 - blue, 6 - purple, 7 - dull pink.

----
#### add_iface_tag
`int sfall_func0("add_iface_tag")`  
`int sfall_func2("add_iface_tag", int msgNum, int color)`
- Добавляет один пользовательский бокс уведомлений к текущим боксам, и возвращает номер добавленного тега (-1, если добавить не удалось или превышен лимит тегов).
- **msgNum**: Используемый номер строки сообщения из файла **INTRFACE.MSG** (необязательный аргумент).
- **color**: Используемый цвет для текста, 0 - зеленый (по умолчанию), 1 - красный.
- Максимальное количество боксов уведомлений для версий sfall 5.0.3 и ниже, ограничено 126 тегами.
- Функция без аргументов (макрос `add_iface_tag`) добавляет бокс уведомления без текста, в этом случае вам придется воспользоваться функцией `set_iface_tag_text` для установки текста.

----
#### inventory_redraw
`void sfall_func1("inventory_redraw", int invType)`
- Перерисовывает список предметов в интерфейсах инвентаря (см. определение `WINTYPE_INVENTORY`).
- **invType**: Аргумент указывает, какой список предметов должен быть перерисован: 0 - PC, 1 - контейнер/NPC, -1 - обе стороны (то же, что и без аргумента).

----
#### item_make_explosive
`void sfall_func3("item_make_explosive", int pid, int activePid, int damage)`  
`void sfall_func4("item_make_explosive", int pid, int activePid, int min, int max)`
- Делает указанный предмет со свойством как взрывчатка, такие как, динамит.
- **activePid**: PID-номер для предмета с активным таймером, номер может совпадать с указанным номером основного предмета (аргумент **pid**).
- **min/max**: Минимальный и максимальный наносимый ущерб (damage) от взрыва.
- Использование функции для предмета, который уже установлен как взрывной, переопределит его предыдущие настройки.
- Функция не работает для предметов с PID номером: **Dynamite** и **Plastic Explosives**.
- __ВНИМАНИЕ:__ Прототип предмета должен быть типом `Misc Item` и иметь установленный флаг действия `Use`.

----
#### get_string_pointer
`int sfall_func1("get_string_pointer", string text)`
- Возвращает указатель на строковую переменную или непосредственно на текст.

----
#### dialog_message
`void sfall_func1("dialog_message", string text)`
- Печатает сообщение в окне ответа NPC в интерфейсе диалога или бартера.
- Поддерживается длина сообщения до 900 символов. 

----
#### get_current_inven_size
`int sfall_func1("get_current_inven_size", object)`
- Возвращает текущий размер инвентаря объекта (т.е. свободное место в контейнере или инвентаря криттера).

----
#### create_win
`void sfall_func5("create_win", string winName, int x, int y, int width, int height)`  
`void sfall_func6("create_win", string winName, int x, int y, int width, int height, int flags)`
- Функция выполняет тоже самое, что и ванильная функция `CreateWin`, но создает окно с флагом `MoveOnTop`, если аргумент **flags** не указан, или позволяет установить дополнительные флаги для создаваемого окна.
- Флаг `MoveOnTop` позволяет разместить создаваемое окно поверх игрового интерфейса.

----
#### set_can_rest_on_map
`void sfall_func3("set_can_rest_on_map", int mapNum, int elev, bool value)`
- Разрешает или запрещает возможность отдохнуть на карте для указанного уровня, это переопределяет значения `can_rest_here` в **maps.txt**.
- **mapNum**: Номер карты из файла **maps.txt**.
- **elev**: Уровень карты для которой устанавливается значение, передача значения -1 в аргумент приведет к установке для всех уровней карты.
- __ПРИМЕЧАНИЕ__: Установленное значение будет сохранено в сохраненной игре (в файле **sfalldb.sav**).

----
#### get_can_rest_on_map
`int sfall_func2("get_can_rest_on_map", int mapNum, int elev)`
- Возвращает значение для карты установленное функцией `set_can_rest_on_map`.
- Если значение для карты не было ранее задано, то возвращается значение -1 (значения `can_rest_here` из файла **maps.txt** игнорируются).

----
#### obj_under_cursor
`object sfall_func1("obj_under_cursor", int objType)`  
`object sfall_func2("obj_under_cursor", int objectType, bool checkDude)`
- Возвращает объект находящийся на карте под указателем курсора мышки.
- **objectType**: Значение типа объекта, который требуется получить, при этом будут игнорироваться перекрываемые объекты другого типа, или передайте значение -1, для того чтобы получить самый верхний объект расположенный под курсором.
- **checkDude**: В том случае если требуется возвратить объект `dude_obj`, предайте значение `true` в аргумент, иначе объект будет игнорироваться (необязательный аргумент).
- __ПРИМЕЧАНИЕ:__ Для корректного получения объекта, расположенного на гексе, когда курсор находится в режиме шестиугольника (передвижения игрока), используйте функцию `tile_under_cursor`.

----
#### dialog_obj
`object sfall_func0("dialog_obj")`
- Возвращает объект (криттер), с которым игрок ведет разговор или осуществляет торговлю.

----
#### loot_obj
`object sfall_func0("loot_obj")`
- Возвращает объект контейнер или криттер, с которым в данный момент обменивается игрок (т.е. когда, открыто окно инвентаря обмена `WINTYPE_INVENLOOT`). 

----
#### get_object_data
`int sfall_func2("get_object_data", object, int offset)`
- Возвращает данные объекта по указанному смещению (см. константы смещений `OBJ_DATA_*` в **define_extra.h**).

----
#### set_object_data
`void sfall_func3("set_object_data", object obj, int offset, int data)`
- Устанавливает данные объекта по указанному смещению.

----
#### get_object_ai_data
`int sfall_func2("get_object_ai_data", object critter, int aiParam)`
- Возвращает значение настройки из AI-пакета объекта (critter).
- Используйте константы `AI_CAP_*` из **define_extra.h** для аргумента **aiParam**, чтобы получить значение AI.

-----
##### art_cache_clear
`void sfall_func0("art_cache_clear")`
- Очищает кэш изображений от загруженных в память FRM-файлов.

----
#### npc_engine_level_up
`void sfall_func1("npc_engine_level_up", bool toggle)`
- Включает или выключает функцию движка, повышающую уровень членов партии в процессе повышения уровня игрока.
- __ВНИМАНИЕ:__ Если функция отключена, процесс повышения уровня членов партии должен осуществляться скриптовыми функциями.

----
#### set_drugs_data
`void sfall_func3("set_drugs_data", int type, int pid, int value)`
- Переопределяет параметры для предметов типа `Drugs` [установленные в конфигурационном файле, опции **DrugsFile** в файле **ddraw.ini**].
- **type** тип изменяемого параметра:  
    0 - изменяет значение **NumEffects** для препарата (описание для **NumEffects** см. в файле **Drugs.ini**)  
	1 - изменяет продолжительность эффекта привыкания (addiction effect) для препарата (значение 1 эквивалентно одной игровой минуте)
- __ВНИМАНИЕ:__ Начиная с версии sfall 5.0.6, функция работает независимо от наличия подключенного конфигурационного файла в **DrugsFile**.

----
#### set_unique_id
`int sfall_func1("set_unique_id", object obj)`  
`int sfall_func2("set_unique_id", object obj, int flag)`
- Присваивает объекту уникальный идентификационный номер (ID) и возвращает его (если уникальный номер уже был присвоен объекту, то идентификационный номер возвращается без переназначения).
- Уникальные ID-номера сохраняются в вашем сохранение и имеют диапазон от `0x10000000` до `0x7FFFFFF`.
- Также существует диапазон уникальных идентификационных номеров для игрока и его партийцев от 18000 до 83535.
- Чтобы получить текущий идентификационный номер объекта, используйте функцию `sfall_func2("get_object_data", obj, OBJ_DATA_ID)`.
- Чтобы присвоить объекту новый идентификационный номер, сгенерированный движком (т.е. отменить присвоение уникального идентификатора), вызовите функцию с двумя аргументами и передайте значение -1 в аргументе **flag**.
- __ВНИМАНИЕ:__ Предметы с уникальными идентификаторами не будут складываться с другими предметами одного и того же типа в инвентаре.

----
#### draw_image | draw_image_scaled
`void sfall_func5("draw_image", string/int pathFile/artId, int frame, int x, int y, bool noTransparent)`  
`void sfall_func6("draw_image_scaled", string/int pathFile/artId, int frame, int x, int y, int width, int height)`
- Отрисовывает указанное изображение **PCX** или **FRM** в активное окно, созданное ванильной функцией `CreateWin` или с помощью sfall функции `create_win`.
- **pathFile/artId**: Путь к файлу PCX/FRM (например **art\\\inven\\5mmap.frm**), или его идентификационный номер FRM (например `0x7000026`, см. спецификацию формата FID).

*Необязательные аргументы:*
- **frame**: Номер кадра в FRM изображении (первый кадр начинается с нуля).
- **x/y**: Координаты точки относительно левого верхнего угла окна, с которой начнется рисование.
- **width/height**: Размер изображения, используемый для масштабирования изображения при его рисовании. Передайте -1 к ширине или высоте, чтобы сохранить соотношение сторон при масштабировании.
- **noTransparent**: Передайте `True`, чтобы отобразить изображение без прозрачного фона.
- __ПРИМЕЧАНИЕ:__ Если `draw_image_scaled` вызывается без аргументов **x/y/width/height**, изображение будет масштабировано так, чтобы поместиться в окно без прозрачного фона.

----
#### draw_line
`int sfall_func6("draw_line", int winType, int x0, int y0, int x1, int y1, int color)`
- Рисует линию толщиной в один пиксель в указанном окне, начиная с координат точки **x0/y0**, до координат точки **x1/y1**.
- **winType**: Номер типа окна интерфейса (см. константы `WINTYPE_*` в **sfall.h**), если передано значение -1, то рисование будет происходить в текущем скриптовом окне.
- **color**: Индекс цвета в палитре игры (от 0 до 255).

----
#### set_fake_perk_npc | set_fake_trait_npc | set_selectable_perk_npc | has_fake_perk_npc | has_fake_trait_npc
`void sfall_func5("set_fake_perk_npc", object npc, string namePerk, int level, int image, string desc)`  
`void sfall_func5("set_fake_trait_npc", object npc, string nameTrait, int active, int image, string desc)`  
`void sfall_func5("set_selectable_perk_npc", object npc, string namePerk, int active, int image, string desc)`  
`int  sfall_func2("has_fake_perk_npc", object npc, string namePerk)`  
`int  sfall_func2("has_fake_trait_npc", object npc, string nameTrait)`
- These functions are similar to `has_fake_perk`, `has_fake_trait`, `set_fake_perk`, `set_fake_trait`, and `set_selectable_perk`, `set_selectable_trait` functions, but apply to the specified party member NPC (including `dude_obj`)

----
#### add_extra_msg_file
`int sfall_func1("add_extra_msg_file", string fileName)`  
`int sfall_func2("add_extra_msg_file", string fileName, int fileNumber)`
- Загружает пользовательский MSG-файл сообщений и возвращает присвоенный ему идентификационный номер файла в диапазоне от `0x3000` до `0x3FFF`, чтобы функция `message_str_game` могла получать сообщения из этого файла.
- **fileName**: Имя файла пользовательского сообщения (включая расширение **.msg**) расположенного в директории пути `text\<language>\game\`. Если MSG-файл не существует в текущем языковом каталоге, функция попытается загрузить его из директории `text\english\game\`.

*Необязательные аргументы:*
- **fileNumber**: Идентификационный номер файла для функции `message_str_game`. Доступный диапазон от `0x2000` до `0x2FFF` (см. опцию **ExtraGameMsgFileList** в ddraw.ini). Используйте это в том случае, если вы хотите добавить файл сообщения без редактирования **ddraw.ini**, или существующих скриптов для поддержки старого способа.

----
#### unwield_slot
`void sfall_func2("unwield_slot", object critter, int slot, *int refresh)`
- Снимает экипированный предмет из указанного слота для существа или персонажа игрока.
- **slot**: 0 - слот брони, 1 - правый слот, 2 - левый слот (см. `INVEN_TYPE_*` в **define.h**).
- **refresh**: передайте 0 - чтобы предотвратить обновление слота на панели интерфейса игрока (необязательный агрумент, по умолчанию всегда обновляет).
- В отличее от других функций, функция может снимать экипированный предмет, когда инвентарь игрока открыт, или игрок находится в режиме торговли.

----
#### add_trait
`void sfall_func1("add_trait", int traitID)`
- Добавляет указанный трейт к персонажу игрока.

----
#### get_inven_ap_cost
`int sfall_func0("get_inven_ap_cost")`
- Возвращает текущую стоимость AP для доступа к инвентарю в бою.

----
#### add_g_timer_event
`void sfall_func2("add_g_timer_event", int time, int fixedParam)`
- Добавляет событие таймера, вызывающее процедуру `timed_event_p_proc` в текущем глобальном скрипте.
- **time**: Количество игровых тиков (для примера см. `ONE_GAME_*` определения), после которого срабатывает таймер события.
- **fixedParam**: Значение, передаваемое процедуре `timed_event_p_proc` для функции `fixed_param`.
- Макрос: `add_global_timer_event(time, fixedParam)`.

----
#### remove_timer_event
`void sfall_func0("remove_timer_event")`  
`void sfall_func1("remove_timer_event", int fixedParam)`
- Очищает все установленные события таймера для текущего глобального скрипта.
- **fixedParam**: Удаляет все события таймера с указанным значением для текущего глобального скрипта.

----
#### get_sfall_arg_at
`mixed sfall_func1("get_sfall_arg_at", int argNum)`
- Получает значение аргумента крючка с указанным номером аргумента.
- **argNum**: Запрашиваемый номер аргумента (первый аргумент начинается с нуля).

----
#### get_sfall_return
`mixed sfall_func1("get_sfall_return", int argNum)`
- Получает значение указанного номера возвращаемого аргумента крючка, которое было переопределено функцией `set_sfall_return`, например в предыдущем скрипте крючка.

----
#### get_sfall_return_count
`int sfall_func0("get_sfall_return")`
- Возвращает количество (на текущий момент времени) переопределенных функцией `set_sfall_return` значений выполняемого в данный момент крючка. 

----
#### hide_window
`void sfall_func0("hide_window")`  
`void sfall_func1("hide_window", string winName)`
- Скрывает указанное или активное (выбранное) в данный момент скриптовое окно.
- **winName**: имя окна, присвоенное окну функцией `CreateWin` или `create_win`.

----
#### show_window
`void sfall_func0("show_window")`  
`void sfall_func1("show_window", string winName)`
- Отображает указанное скрытое скриптовое окно или окно ранее скрытое функцией `sfall_func0("hide_window")`.
- **winName**: имя окна, присвоенное окну функцией `CreateWin` или `create_win`.

----
#### set_window_flag
`void sfall_func3("set_window_flag", string/int winName/winID, int flag, bool value)`
- Изменяет указанный флаг для созданного скриптового или игрового интерфейсного окна.
- **winName**: имя окна, присвоенное окну функциями `CreateWin` или `create_win`.
- **winID**: идентификационный номер интерфейса или скриптового окна, полученного с помощью функции `get_window_under_mouse` или 0 для текущего интерфейса игры.
- **flag**: номер флага который необходимо изменить (см. константы `WIN_FLAG_*` в **define_extra.h**).
- **value**: `True` - устанавливает флаг, `False` - сбрасывает флаг.

----
#### get_text_width
`int sfall_func1("get_text_width", string text)`
- Возвращает значение ширины текста в пикселях для текущего установленного шрифта.

----
#### string_compare
`bool sfall_func2("string_compare", string str1, string str2)`  
`bool sfall_func3("string_compare", string str1, string str2, int codePage)`
- Сравнивает две строки без учета регистра и возвращает `True` если две строки совпадают.
- **codePage**: Номер кодовой страницы для правильного сравнения национальных символов в диапазоне 128..255 **ASCII** таблицы. Доступные кодировки: 1250-1252, 866.

----
#### string_format
`string sfall_func2("string_format", string format, any val1, ...)`
- Форматирует заданное значение, используя стандартный синтаксис функции `sprintf` (подробности формата см. в разделе `printf` языка C).
- Функция ограничена форматированием до 7 аргументов (в sfall версиях до 5.0.5 ограничение составляет до 4).
- Длина строки формата ограничена 1024 символами.
- Форматирование ДО версий sfall 5.0.5 поддерживается только для `%s`, и `%d`.

----
#### objects_in_radius
`array sfall_func3("objects_in_radius", int tile, int radius, int elevation)`  
`array sfall_func4("objects_in_radius", int tile, int radius, int elevation, int type)`
- Возвращает массив объектов определенного типа (см. константы `OBJ_TYPE_*` в **define_extra.h**) в указанном радиусе от заданного гекса.
- Функция возвратит все типы объекты находящиеся в радиусе, если передать значение -1 в аргумент **type**, или опустить его.
- Радиус действия ограничен 50 гексами.

----
#### tile_by_position
`int sfall_func2("tile_by_position", int x, int y)`
- Возвращает номер гекса карты в позиции x, y относительно левого верхнего угла игрового экрана.
- Если позиция находится за пределами диапазона гексов, возвращается -1.

----
#### string_to_case
`string sfall_func2("string_to_case", string text, int toCase)`
- Преобразует все буквы в заданной строке в указанный регистр.
- **toCase**: 0 - строчный (lowercase), 1 - прописной (uppercase).
- __ВНИМАНИЕ:__ Функция работает только для английских букв `A-Z` и `a-z`.

----
#### get_terrain_type
`string sfall_func0("get_terrain_type")`  
`string sfall_func2("get_terrain_type", int x, int y)`
- Возвращает тип местности (см. `TERRAIN_TYPE_*` в **define_extra.h**) для суб-тайла на карте мира по указанным координатам, или по текущей позиции игрока, если функция вызывается без аргументов.
- В случае любой ошибки возвращает -1.

----
#### get_terrain_name
`string sfall_func0("get_terrain_name")`  
`string sfall_func2("get_terrain_name", int x, int y)`
- Возвращает имя типа местности для суб-тайла на карте мира по указанным координатам, или по текущей позиции игрока, если функция вызывается без аргументов.
- Имена типов хранятся в файле **WORLDMAP.MSG** с номерами строк 1000-1004.

----
#### set_terrain_name
`void sfall_func3("set_terrain_name", int x, int y, string name)`
- Переопределяет имя типа местности для суб-тайла на карте мира по указанным координатам.
- Переопределенные имена будет сброшены к значению по умолчанию после перезагрузки игры.

----
#### get_window_attribute
`int sfall_func1("get_window_attribute", int winType)`  
`int sfall_func2("get_window_attribute", int winType, int attrType)`
- Возвращает атрибут указанного интерфейсного окна указанного атрибута в аргументе **attrType**.
- **winType**: Номер типа окна интерфейса (см. константы `WINTYPE_*` в `sfall.h`)
- **attrType**:
    0 - проверяет и возвращает значение 1, если указанное окно интерфейса не является пользовательским/скриптовым (так же, как и без аргумента)  
    1 - X-позиция (относительно левого верхнего угла игрового экрана)  
    2 - Y-позиция (относительно левого верхнего угла игрового экрана)  
    3 - размер ширины интерфейса  
    4 - размер высоты интерфейса  
    5 - номер идентификатора окна **winID** (может использоваться для сравнения с `get_window_under_mouse`)  
   -1 - возвращает ассоциативный массив со значениями **left**, **top**, **right**, **bottom**, определяющие положение прямоугольника окна (доступ к значениям стандартен для массивов, пример: `map.top`, `map.bottom`)
- Функция возвратит значение -1, если указанный атрибут не может быть получен.

----
#### set_town_title
`void sfall_func3("set_town_title", int areaID, string knownTitle, string unknownTitle)`
- Устанавливает всплывающий текст для города на карте мира при наведении курсора на маркер игрока.
- **areaID**: Идентификационный номер города из файла **city.txt**.
- **knownTitle**: Строка текста которая будет печататься, если город ранее посещался.
- **unknownTitle**: Строка текста которая будет печататься, если город еще не был посещен (необязательный аргумент).
- __ПРИМЕЧАНИЕ:__ В случае если аргумент **unknownTitle** был опущен, будет печататься текст из **knownTitle** для обоих состояний.

----
#### message_box
`int sfall_func4("message_box", string message, int flags, int color1, int color2)`
- Создает диалоговое окно с текстом и возвращает результат нажатия кнопки: 0 - Нет (Escape), 1 - Да/Выполнено (Enter).
- Возвращает -1, если по какой-то причине диалоговое окно не может быть создано.
- **message**: Текст в диалоговом окне. Используйте управляющий символ `\n` для переноса текста на новую строку (пример: "Hello\nWorld!").

*Необязательные аргументы:*
- **flags**: Флаги режима диалогового окна (см. константы `MSGBOX_*` в **define_extra.h**). Передайте -1, чтобы не устанавливать флаги (по умолчанию флаги `NORMAL` и `YESNO`).
- **color1/color2**: Индекс цвета текста в палитре Fallout. **color1** - задает цвет для первой строки, **color2** - для всех последующих строк текста (по умолчанию индекс цвета 145).

----
#### get_stat_min | get_stat_max
`int sfall_func1("get_stat_min", int stat)`  
`int sfall_func1("get_stat_max", int stat)`  
`int sfall_func2("get_stat_min", int stat, bool who)`  
`int sfall_func2("get_stat_max", int stat, bool who)`
- Возвращает максимальное или минимальное установленное значение для указанной статистики (см. функции `set_stat_min`, `set_stat_max`).
- **who**: Передача значения `False` или пропуск аргумента возвращает установленное значения для игрока, `True` возвращает значения, установленные для всех NPC.

----
#### interface_art_draw
`int sfall_func6("interface_art_draw", int winType, string artFile/int artID, int x, int y, int frame, array param)`  
`int sfall_func8("interface_art_draw", int winType, string artFile/int artID, int x, int y, int frame, int w, int h, int direction)`
- Рисует указанное PCX или FRM изображение в окне игрового интерфейса, возвращает -1 в случае любой ошибки.
- **winType**: Номер типа окна интерфейса (см. константы `WINTYPE_*` в **sfall.h**). Это также принимает значение флага `0x1000000` для предотвращения немедленной перерисовки окна интерфейса.
- **artFile/artId**: Путь к PCX/FRM файлу (пример **art\\\inven\\5mmap.frm**), или его идентификационный номер FRM (например `0x7000026`, см. спецификацию формата FID).
- **x/y**: Координаты начало рисования картинки (смещение относительно левого верхнего угла окна).
- **w/h**: Новая высота и ширина картинки для масштабирования спрайта.

*Необязательные аргументы:*
- **frame**: Номер кадра в анимированном FRM (первый кадр начинается с нуля).
- **direction**: Направление спрайта (0-5) для для много-направленного FRM.
- **param**: Переданный массив, задающий дополнительные параметры `[direction, width, height]` или `[x, y, width, height]`  
  используйте значение -1 для ширины или высоты массива, чтобы использовать исходные значения ширины или высоты картинки.

----
#### interface_print
`int sfall_func5("interface_print", string text, int winType, int x, int y, int color)`  
`int sfall_func6("interface_print", string text, int winType, int x, int y, int color, int width)`
- Печатает текст в указанном окне интерфейса текущим шрифтом. Используйте функции `SetFont` для установки шрифта.
- Возвращает количество напечатанных строк, или -1 при любой ошибке.
- **text**: Строка текста для печати. Используйте управляющий символ `\n` для переноса текста на новую строку (пример: "Hello\nWorld!").
- **winType**: Номер типа интерфейсного окна (см. константы `WINTYPE_*` в **sfall.h**).
- **x/y**: x и y позиция печати, относительно левого верхнего угла окна.
- **color**: Индекс цвета в палитре Fallout. Передайте 0, если цвет текста был ранее установлен функцией `SetTextColor`.  
    Также может принимать дополнительные флаги (через `bwor`) для отображения текста:  
    `0x0010000` - добавляет тень к тексту, константа компилятора `textshadow`  
    `0x1000000` - чтобы предотвратить немедленную перерисовку окна интерфейса, константа компилятора `textdirect` (работает наоборот)  
    `0x2000000` - заполняет фон текста черным цветом, константа компилятора `textnofill` (работает наоборот)

*Необязательные аргументы:*
- **width**: Максимальная ширина текста. Текст будет обернут так, чтобы поместиться в указанную ширину.

----
#### combat_data
`mixed sfall_func0("combat_data")`
- Получает указатель на данные `C_ATTACK_*` для текущего хода боевой атаки (см. определенные константы в **define_extra.h**).
- Может использоваться совместно с функциями `get_object_data` и `set_object_data`.
  Пример: `sfall_func3("set_object_data", sfall_func0("combat_data"), C_ATTACK_UNUSED, 255);`

----
#### win_fill_color
`int sfall_func0("win_fill_color")`  
`int sfall_func5("win_fill_color", int x, int y, int width, int height, int color)`
- Заполняет прямоугольную область выбранного в данный момент скриптового окна указанным цветом или очищает прозрачное окно (используйте функцию без аргументов или с индексом цвета 0).
- **color**: Индекс цвета в палитре игры (от 0 до 255).

----
#### interface_overlay
`int sfall_func7("interface_overlay", int winType, int mode, int id, int x, int y, int w, int h)`
- Функция для работы с поверхностями (создание, очистка и удаление) окон интерфейса для рисования.
- Созданные поверхности располагаются над основным графическим окном интерфейса, что позволяет рисовать без проблем связанных с перерисовкой заднего фона интерфейса.
- Для того чтобы рисовать на поверхностях воспользуйтесь одной из имеющихся функций для рисования, предварительно установив номер поверхности для рисования (макрос `overlay_set_draw`).
- **winType**: Номер типа окна интерфейса (см. константы `WINTYPE_*` в **sfall.h**).
- **mode**:  
    0 - удаляет созданную поверхность наложения (макрос `overlay_destroy`). Все окно перерисовывается.  
    1 - создает новую поверхность наложения (макрос `overlay_create`).  
    2 - очищает всю область наложения или указанный прямоугольник определяемый аргументами `x, y, w, h` (макросы `overlay_clear`, `overlay_clear_rectangle`).  
    3 - устанавливает поверхность для рисования (макрос `overlay_set_draw`).  
    4 - тоже что и 2, но дополнительно перерисовывает прямоугольник окна (макросы `overlay_clear_redraw`, `overlay_clear_rect_redraw`).
- **id**: Номер ранее созданной поверхности (см. описание макроса `overlay_create`).
- Возвращает -1 в случае любой ошибки.

----
#### overlay_create `macro`
`int sfall_func2("interface_overlay", winType, 1)`
- Создает дополнительные поверхности рисования для указанного окна интерфейса.
- Возвращает номер созданной поверхности, или -1 в случае ошибки.

----
#### overlay_set_draw `macro`
`int sfall_func2("interface_overlay", winType, 3, id)`
- Устанавливает слой поверхности для рисования, определяемый номером **ID** созданной поверхности.
- Передача значения 0 в аргумент **id**, вернет отрисовку обратно на основную поверхность интерфейса (рекомендуется это сделать после того как закончили рисовать).

#### overlay_destroy `macro`
`int sfall_func2("interface_overlay", winType, 0)`
- Удаляет созданный слой с обновлением интерфейса, функция может быть применена в случае когда слой больше не потребуется.
- При закрытии окна, все созданные слои уничтожаются автоматически.

----
#### set_quest_failure_value
`void sfall_func2("set_quest_failure_value", int gvarNumber, int thresholdValue)`
- Задает пороговое значение (failure_threshold) для квеста, при котором квест будет считаться проваленным (его описание в Pip-Boy будет зачеркнуто и окрашено в красный цвет).
- **gvarNumber**: Номер глобальной переменной, управляющей квестом.
- **thresholdValue**: Значение глобальной переменной, при котором квест считается провальным.

----
#### set_scr_name
`void sfall_func1("set_scr_name", string name)`
- Переопределяет имя объекта сценария, которое было задано из **scrname.msg**.
- Измененное имя будет сбрасываться каждый раз, когда игрок покидает карту или перезагружает игру.
- Передача пустой строки ("") в аргумент **name** или его отсутствие позволит игре получить имя объекта из файлов **pro_*.msg**.
- __ПРИМЕЧАНИЕ:__ Функция предназначена для использования в обычных игровых скриптах и переопределяет имя только один раз (для одного и того же объекта) до тех пор, пока не произойдет сброс игры.

----
#### obj_is_openable
`bool sfall_func1("obj_is_openable", object obj)`
- Возвращает `True`, если объект можно открыть (т.е. имеет анимацию открытия/закрытия), иначе `False`.

----
#### add_button
`int sfall_func8("add_button", int winType, int x, int y, int w, int h, string upPic, string downPic, string hoverPic)`
- Добавляет кнопку на указанное окно интерфейса игры, и возвращает **ID-номер** добавленной кнопки (аналогична ванильной функции AddButton).
- **upPic/downPic**: Имя **PCX** файлов изображения для нажатой и отпущенной кнопки.
- **hoverPic**: Имя **PCX** файла для изображения кнопки, когда курсор мышки будет находиться над кнопкой (необязательный аргумент).
- __ВНИМАНИЕ:__ Созданная кнопка удаляется автоматически после закрытия окна интерфейса, но вы обязательно должны использовать функцию `button_free` чтобы освободить ресурсы используемые кнопкой.

----
#### button_free
`void sfall_func1("button_free", int buttonID)`
- Удаляет ранее созданную кнопку функцией `add_button`.

----
#### set_button_procedure
`void sfall_func5("set_button_proc", int buttonID, int pressProc, int releaseProc*, int enterProc*, int leaveProc*)`
- Привязывает к созданной кнопке (функцией `add_button`) скриптовые обработчики для событий кнопки нажатия/отпускания, и входа/выхода курсора мышки.
- **pressProc**: Процедура обработчик для события нажатия левой кнопки мышки по региону.
- **releaseProc**: Процедура обработчик для события отпускания левой кнопки мышки в регионе.
- **enterProc**: Процедура обработчик для события входа курсора мышки в регион.
- **leaveProc**: Процедура обработчик для события выхода курсора мышки из региона.
- __ПРИМЕЧАНИЕ:__ Для указания процедур обработчиков используйте оператор `&` перед именем процедуры (подробнее см. описание компилятора в **sslc_readme.md**).  

----
#### set_button_state
`void sfall_func3("set_button_state", string name, int mode, int state)`
- Устанавливает состояния для скриптовых кнопок выбранного интерфейсного окна.
- **name**: Имя созданной кнопки.
- **mode**:  
    0 - удаляет флаг для кнопки (значение **state** указывает флаг).  
    1 - устанавливает флаг для кнопки.  
    2 - устанавливает состояние для кнопки, значение **state** определяет: 1 - нажато, 0 - отжато.
- **state**: устанавливаемое значение.

----
#### get_attack_damage
`int sfall_func3("get_attack_damage", object critter, int attackType, int mode*)`
- Возвращает наносимые повреждения для указанного типа рукопашной (hand-to-hand) атаки.
- **critter**: Указатель на криттер (валидно на данный момент только `dude_obj`, `real_dude_obj`).
- **attackType**: Тип рукопашной атаки (см. константы `ATKTYPE_*` в **sfall.h**).
- **mode**: Значение режима функции, 0 возвращает максимальное значение, 1 минимальное значение повреждение рукопашной атаки. 
- Связанные макросы: `get_attack_damage_min`, `get_attack_damage_max`.

----
#### get_attack_range
`int sfall_func2("get_attack_range", object critter, int attackType)`
- Возвращает максимальную дистанцию действия атаки (в гексах) для указанного типа атаки.
- **critter**: Указатель на криттер.
- **attackType**: Тип атаки (см. константы `ATKTYPE_*` в **sfall.h**).

----
#### get_weapon_damage
`int sfall_func4("get_weapon_damage", object weapon, int attackType, object critter, int mode*)`
- Возвращает наносимые повреждения для указанного предмета оружия. При расчете учитываются модификаторы указанного криттера влияющие на повреждение. 
- **weapon**: Указатель на предмет оружия.
- **attackType**: Режим атаки оружия (см. константы `ATKTYPE_*` в **sfall.h**).
- **critter**: Криттер владелец оружия.
- **mode**: Значение режима функции, 0 возвращает максимальное значение, 1 минимальное значение повреждение у оружия. 
- Связанные макросы: `get_weapon_damage_min`, `get_weapon_damage_max`.

----
#### get_weapon_type
`int sfall_func2("get_weapon_type", object weapon, int attackType)`
- Возвращает подтип оружия - стрелковое, метательное и т.д (см. константы `WEAPON_TYPE_*` в **define_extra.h**).
- **weapon**: Указатель на предмет оружие (если указатель равен 0, то возвращается `WEAPON_TYPE_UNARMED`).
- **attackType**: Режим атаки для оружия (см. константы `ATKTYPE_*` в **sfall.h**).

----
#### get_weapon_radius
`int sfall_func2("get_weapon_radius", object weapon, int attackType)`
- Возвращает радиус поражения оружия в гексах.
- Возвращаемое значение 0, означает что оружие принадлежит к классу не имеющего радиус поражения.
- **weapon**: Указатель на предмет оружие.
- **attackType**: Режим атаки для оружия (см. константы `ATKTYPE_*` в **sfall.h**).

----
#### get_weapon_range
`int sfall_func3("get_weapon_range", object weapon, int attackType, object critter)`
- Возвращает максимальную дистанцию действия (в гексах) для указанного оружия. Дистанция рассчитывается с модификаторами для криттера.
- **weapon**: Указатель на предмет оружия.
- **attackType**: Режим атаки для оружия (см. константы `ATKTYPE_*` в **sfall.h**).
- **critter**: Криттер для которого рассчитывается значение дистанции, передайте значение 0 (или опустите аргумент), чтобы получить дистанцию без модификаторов.  

----
#### is_party_member
`bool sfall_func1("is_party_member", object critter)`
- Возвращает `True` если криттер является потенциальным партийцем игрока, т.е. прописан в файле **party.txt**.

----
#### get_hit_chance_max
`int sfall_func2("get_hit_chance_max", int hitChance, object critter)`
- Возвращает модифицированный/максимальный шанс попадания с учетом модификаторов установленные функциями `set_hit_chance_max` и `set_base_hit_chance_mod`.
- **hitChance**: Переданное значение шанса, которое требуется модифицировать или ограничить до максимального установленного значения в случае его превышения.
- **critter**: Криттер для которого ранее был установлен модификатор и максимальный шанс функцией `set_critter_hit_chance_mod`. Необязательный аргумент.
- Функция с опущенными аргументами просто возвратит текущее установленное максимальное значение для шанса.

----
#### add_extra_perk
`int sfall_func2("add_extra_perk", int ePerkID, array data)`
- Добавляет дополнительный перк в игру, если перк с таким номером не был еще добавлен с помощью файла опции **PerksFile**.
- **ePerkID**: ID добавляемого дополнительного перка (валидные номера 119...255).
- **data**: Массив с настройки параметров для дополнительного перка. Массив должен иметь 10 элементов, с последовательно идущими данными от **Stat1** до **Skill5Mod**, см. формат файла **Perks.ini**.
- Для настройки имени/описания/картинки добавляемого перка и других его параметров, воспользуйтесь sfall функциями для ванильных перков, такими как `set_perk_name`, `set_perk_desc`, `set_perk_ranks`.
- Функция возвратит значение -2 если перк с таким ID уже был добавлен ранее, или -1 при любой другой ошибке.

----
#### make_path_to
`array sfall_func3("make_path_to", object objFrom, int tileTo, int blockingType)`
- Возвращает построенный путь в виде массива плиток к указанной плитке с использованием заданного типа блокировки.
- Функция является альтернативой `path_find_to` (см. ее описание), с той разницей, что нет необходимости пошагово вычислять требуемую плитку построенного пути.

----
#### set_spray_settings
`void sfall_func4("set_spray_settings", int centerMult, int centerDiv, int targetMult, int targetDiv)`
- Позволяет динамически изменять множители и делители для распределения пуль при атаках очередью.
- Все настройки автоматически сбрасываются на значения по умолчанию (или настройки установленные в **ComputeSpray_\*** ddraw.ini) после каждого действия атаки.
- Функция должна быть использована перед расчетом распределения пуль очереди, например в `HOOK_TOHIT` или `HOOK_AMMOCOST`.
- **centerDiv/targetDiv**: Минимальное значение делителя является 1.
- **centerMult/targetMult**: Значения множителей ограничены значениями делителей.
- __ПРИМЕЧАНИЕ:__ Обратитесь к описанию параметров **ComputeSpray_\*** в **ddraw.ini** для получения подробной информации о распределении пуль для атак очередью.

----
#### get_combat_free_move
`int sfall_func0("get_combat_free_move")`
- Возвращает текущие бонусные очки передвижения криттера (желтые очки действий в бою на панели интерфейса).
- Для NPC это значение всегда равно 0, если это ранее не было изменено с помощью функции `set_combat_free_move`.

----
#### set_combat_free_move
`void sfall_func1("set_combat_free_move", int value)`
- Позволяет изменить (установить) бонусные очки для передвижения в бою (желтые очки действий на панели интерфейса).
- Функция может быть использована из `HOOK_STDPROCEDURE` совместно с событием `combat_p_proc`, или из `HOOK_COMBATTURN` в начале хода (в этом случае не будет работать для `dude_obj`).

----
#### string_find
`int sfall_func3("string_find", string text, string findString, int position)`
- Возвращает позицию первого вхождения строки **findString** в строкe **text**, или -1 если искомое значение не было найдено (первая позиция символа начинается с нуля).
- **position**: Позиция, с которой следует начать поиск в строкe **text**. Если задано отрицательное значение, то это указывает на позицию, начинающуюся с конца строки. Необязательный аргумент.
- Связанные макросы: `string_find_from`.

----
#### set_object_light
`void sfall_func3("set_object_light", object obj, int intensity, int distance)`
- Делает объект способным излучать свет.
- Функция аналогична ванильной `obj_set_light_level` за исключением того, что интенсивность света устанавливается непосредственным значением в диапазоне от 0 до 65536.

----
#### combat_critter_damage
`int sfall_func6("combat_critter_damage", object source, object critter, int minDamage, int maxDamage, int dmgType, int attackType)`
- Наносит повреждения указанному криттеру.
- Функция аналогична ванильной `critter_dmg`, за исключением того, что функцию рекомендуется применять в начале текущей атаки боя, например в крючке `HOOK_COMBATDAMAGE`, или же в крючках взрыва `HOOK_ONEXPLOSION`, `HOOK_EXPLOSIONDAMAGE`.
- По умолчанию урон наносимый криттерам рассчитывается также как при взрывах функцией `explosion` или `critter_dmg`, чтобы изменить расчет на общую формулу передайте в аргумент **dmgType**, значение -1 (см. ниже).
- **source**: Источник урона, это может быть объект взрыва или атакующий криттер.
- **critter**: Криттер которому будет нанесены повреждения.
- **dmgType**: Тип нанесенных повреждений (аналогично `critter_dmg`), или -1 чтобы использовался тип повреждений от используемого оружия атакующего.
- **attackType**: Указывает режим атаки атакующего (см. определения `ATKTYPE_*` в sfall.h). Необязательный аргумент, используется только в случае указания значения -1 в аргументе **dmgType**.

----
#### add_region
`int sfall_func6("add_region", int winType, string regionName, int x, int y, int width, int height)`
- Добавляет прямоугольный регион в окно игрового интерфейса, по координатам `x/y` с указанным размером.
- **winType**: Тип окна интерфейса (см. определения `WINTYPE_*` в sfall.h).
- **regionName**: Имя для создаваемого региона (длина ограничена 31 символами).

----
#### delete_region
`int sfall_func2("delete_region", int winType, string regionName)`
- Удаляет ранее созданный регион функцией `add_region`.
- **winType**: Тип окна интерфейса (см. определения `WINTYPE_*` в sfall.h).
- **regionName**: Имя региона.
- __ПРИМЕЧАНИЕ:__ Все созданные регионы удаляются автоматически при удалении окна интерфейса.

----
#### set_region_procedure
`int sfall_func8("set_region_proc", int winType, string regionName, int enter, int leave, int press, int release, int pressRight, int releaseRight)`
- Устанавливает для ранее созданного региона скриптовую процедуру для обработки события.
- **winType**: Тип окна интерфейса (см. определения `WINTYPE_*` в sfall.h).
- **regionName**: Имя созданного региона.
- **enter**: Процедура обработчик для события входа курсора мышки в регион.

*Необязательные аргументы:*
- **leave**: Процедура обработчик для события выхода курсора мышки из региона.
- **press**: Процедура обработчик для события нажатия левой кнопки мышки по региону.
- **release**: Процедура обработчик для события отпускания левой кнопки мышки в регионе.
- **pressRight/releaseRight**: Процедуры обработчики для события нажатия/отпускания правой кнопки мышки. 
- __ПРИМЕЧАНИЕ:__ Чтобы назначить скриптовую процедуру для обработчика воспользуйтесь синтаксисом компилятора для взятия номера процедуры (см. описание в **sslc_readme.md**).

----
#### art_size
`array sfall_func3("art_frame_data", string/int fileID, int frame, int direction)`
- Возвращает размер ширины и высоты указанного кадра изображения **PCX** или **FRM**, в виде временного массива в форме `[width, height]`.
- **fileID**: Путь к файлу (например `art\\inven\\5mmap.frm`), или его идентификационный номер FRM (например `0x7000026`, см. спецификацию формата FID).

*Необязательные аргументы:*
- **frame**: Номер кадра (первый кадр начинается с нуля).
- **direction**: Направление, для которого нужно получить кадр.

----
#### set_worldmap_heal_time
`void sfall_func1("set_worldmap_heal_time", int minutes)`
- Устанавливает временной интервал в минутах для восстановления здоровья во время путешествия по карте мира.
- Установка значения интервала на -1, отключает исцеление во время путешествий.
- Передача значения 0 приведет к возврату к значению по умолчанию. По умолчанию 360.
- Временной интервал будет сбрасываться к значению по умолчанию каждый раз, когда игра перезагружается.

----
#### add_message_game
`void sfall_func3("add_message_game", int msgFileNum, int msgLineNum, string msgText)`
- Добавляет или изменяет существующую строку текста в игровом файле сообщений (содержимое файла на диске не изменяется).
- **msgFileNum**: Номер игрового файла сообщений (см. определения констант `GAME_MSG_*` в sfall.h).
- **msgLineNum**: Номер строки сообщения в текстовом файле сообщений.
- **msgText**: Новая текстовая строка, которая будет добавлена или заменена.
- Все добавленные сообщения сбрасываются к содержимому файлу, после того как игрок перегружает игру. 

----
#### signal_close_game
`void sfall_func0("signal_close_game")`
- Принудительно выходит в главное меню игры, и завершает ее выполнение (закрывает игру).

****
Обратитесь к другим файлам документации **[Arrays.md](https://gitverse.ru/sfall_projects/sfall/content/Releases/scripting/arrays.md)**, **[HookScripts.md](https://gitverse.ru/sfall_projects/sfall/content/Releases/scripting/HookScripts.md)** для ссылок на связанные функции.
